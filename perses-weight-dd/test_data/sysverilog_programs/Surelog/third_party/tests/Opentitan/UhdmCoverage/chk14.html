
<!DOCTYPE html>
<html>
<head>
<style>
body {

}
p {
font-size: 14px;
}</style>
<h3>hw/vendor/lowrisc_ibex/rtl/ibex_core.sv Cov: 94% </h3>
<pre style="margin:0; padding:0 ">   1: // Copyright lowRISC contributors.</pre>
<pre style="margin:0; padding:0 ">   2: // Copyright 2018 ETH Zurich and University of Bologna, see also CREDITS.md.</pre>
<pre style="margin:0; padding:0 ">   3: // Licensed under the Apache License, Version 2.0, see LICENSE for details.</pre>
<pre style="margin:0; padding:0 ">   4: // SPDX-License-Identifier: Apache-2.0</pre>
<pre style="margin:0; padding:0 ">   5: </pre>
<pre style="margin:0; padding:0 ">   6: `ifdef RISCV_FORMAL</pre>
<pre style="margin:0; padding:0 ">   7:   `define RVFI</pre>
<pre style="margin:0; padding:0 ">   8: `endif</pre>
<pre style="margin:0; padding:0 ">   9: </pre>
<pre style="margin:0; padding:0 ">  10: /**</pre>
<pre style="margin:0; padding:0 ">  11:  * Top level module of the ibex RISC-V core</pre>
<pre style="margin:0; padding:0 ">  12:  */</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  13: module ibex_core #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  14:     parameter bit          PMPEnable                = 1'b0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  15:     parameter int unsigned PMPGranularity           = 0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  16:     parameter int unsigned PMPNumRegions            = 4,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  17:     parameter int unsigned MHPMCounterNum           = 0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  18:     parameter int unsigned MHPMCounterWidth         = 40,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  19:     parameter bit          RV32E                    = 1'b0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  20:     parameter bit          RV32M                    = 1'b1,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  21:     parameter              MultiplierImplementation = "fast",</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  22:     parameter bit          DbgTriggerEn             = 1'b0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  23:     parameter int unsigned DmHaltAddr               = 32'h1A110800,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  24:     parameter int unsigned DmExceptionAddr          = 32'h1A110808</pre>
<pre style="margin:0; padding:0 ">  25: ) (</pre>
<pre style="margin:0; padding:0 ">  26:     // Clock and Reset</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  27:     input  logic        clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  28:     input  logic        rst_ni,</pre>
<pre style="margin:0; padding:0 ">  29: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  30:     input  logic        test_en_i,     // enable all clock gates for testing</pre>
<pre style="margin:0; padding:0 ">  31: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  32:     input  logic [31:0] hart_id_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  33:     input  logic [31:0] boot_addr_i,</pre>
<pre style="margin:0; padding:0 ">  34: </pre>
<pre style="margin:0; padding:0 ">  35:     // Instruction memory interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  36:     output logic        instr_req_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  37:     input  logic        instr_gnt_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  38:     input  logic        instr_rvalid_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  39:     output logic [31:0] instr_addr_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  40:     input  logic [31:0] instr_rdata_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  41:     input  logic        instr_err_i,</pre>
<pre style="margin:0; padding:0 ">  42: </pre>
<pre style="margin:0; padding:0 ">  43:     // Data memory interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  44:     output logic        data_req_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  45:     input  logic        data_gnt_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  46:     input  logic        data_rvalid_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  47:     output logic        data_we_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  48:     output logic [3:0]  data_be_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  49:     output logic [31:0] data_addr_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  50:     output logic [31:0] data_wdata_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  51:     input  logic [31:0] data_rdata_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  52:     input  logic        data_err_i,</pre>
<pre style="margin:0; padding:0 ">  53: </pre>
<pre style="margin:0; padding:0 ">  54:     // Interrupt inputs</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  55:     input  logic        irq_software_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  56:     input  logic        irq_timer_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  57:     input  logic        irq_external_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  58:     input  logic [14:0] irq_fast_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  59:     input  logic        irq_nm_i,       // non-maskeable interrupt</pre>
<pre style="margin:0; padding:0 ">  60: </pre>
<pre style="margin:0; padding:0 ">  61:     // Debug Interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  62:     input  logic        debug_req_i,</pre>
<pre style="margin:0; padding:0 ">  63: </pre>
<pre style="margin:0; padding:0 ">  64:     // RISC-V Formal Interface</pre>
<pre style="margin:0; padding:0 ">  65:     // Does not comply with the coding standards of _i/_o suffixes, but follows</pre>
<pre style="margin:0; padding:0 ">  66:     // the convention of RISC-V Formal Interface Specification.</pre>
<pre style="margin:0; padding:0 ">  67: `ifdef RVFI</pre>
<pre style="margin:0; padding:0 ">  68:     output logic        rvfi_valid,</pre>
<pre style="margin:0; padding:0 ">  69:     output logic [63:0] rvfi_order,</pre>
<pre style="margin:0; padding:0 ">  70:     output logic [31:0] rvfi_insn,</pre>
<pre style="margin:0; padding:0 ">  71:     output logic        rvfi_trap,</pre>
<pre style="margin:0; padding:0 ">  72:     output logic        rvfi_halt,</pre>
<pre style="margin:0; padding:0 ">  73:     output logic        rvfi_intr,</pre>
<pre style="margin:0; padding:0 ">  74:     output logic [ 1:0] rvfi_mode,</pre>
<pre style="margin:0; padding:0 ">  75:     output logic [ 4:0] rvfi_rs1_addr,</pre>
<pre style="margin:0; padding:0 ">  76:     output logic [ 4:0] rvfi_rs2_addr,</pre>
<pre style="margin:0; padding:0 ">  77:     output logic [31:0] rvfi_rs1_rdata,</pre>
<pre style="margin:0; padding:0 ">  78:     output logic [31:0] rvfi_rs2_rdata,</pre>
<pre style="margin:0; padding:0 ">  79:     output logic [ 4:0] rvfi_rd_addr,</pre>
<pre style="margin:0; padding:0 ">  80:     output logic [31:0] rvfi_rd_wdata,</pre>
<pre style="margin:0; padding:0 ">  81:     output logic [31:0] rvfi_pc_rdata,</pre>
<pre style="margin:0; padding:0 ">  82:     output logic [31:0] rvfi_pc_wdata,</pre>
<pre style="margin:0; padding:0 ">  83:     output logic [31:0] rvfi_mem_addr,</pre>
<pre style="margin:0; padding:0 ">  84:     output logic [ 3:0] rvfi_mem_rmask,</pre>
<pre style="margin:0; padding:0 ">  85:     output logic [ 3:0] rvfi_mem_wmask,</pre>
<pre style="margin:0; padding:0 ">  86:     output logic [31:0] rvfi_mem_rdata,</pre>
<pre style="margin:0; padding:0 ">  87:     output logic [31:0] rvfi_mem_wdata,</pre>
<pre style="margin:0; padding:0 ">  88: `endif</pre>
<pre style="margin:0; padding:0 ">  89: </pre>
<pre style="margin:0; padding:0 ">  90:     // CPU Control Signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  91:     input  logic        fetch_enable_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  92:     output logic        core_sleep_o</pre>
<pre style="margin:0; padding:0 ">  93: );</pre>
<pre style="margin:0; padding:0 ">  94: </pre>
<pre style="margin:0; padding:0 ">  95:   import ibex_pkg::*;</pre>
<pre style="margin:0; padding:0 ">  96: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  97:   localparam int unsigned PMP_NUM_CHAN = 2;</pre>
<pre style="margin:0; padding:0 ">  98: </pre>
<pre style="margin:0; padding:0 ">  99:   // IF/ID signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 100:   logic        instr_valid_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 101:   logic        instr_new_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 102:   logic [31:0] instr_rdata_id;         // Instruction sampled inside IF stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 103:   logic [15:0] instr_rdata_c_id;       // Compressed instruction sampled inside IF stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 104:   logic        instr_is_compressed_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 105:   logic        instr_fetch_err;        // Bus error on instr fetch</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 106:   logic        illegal_c_insn_id;      // Illegal compressed instruction sent to ID stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 107:   logic [31:0] pc_if;                  // Program counter in IF stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 108:   logic [31:0] pc_id;                  // Program counter in ID stage</pre>
<pre style="margin:0; padding:0 "> 109: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 110:   logic        instr_valid_clear;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 111:   logic        pc_set;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 112:   pc_sel_e     pc_mux_id;              // Mux selector for next PC</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 113:   exc_pc_sel_e exc_pc_mux_id;          // Mux selector for exception PC</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 114:   exc_cause_e  exc_cause;              // Exception cause</pre>
<pre style="margin:0; padding:0 "> 115: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 116:   logic        lsu_load_err;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 117:   logic        lsu_store_err;</pre>
<pre style="margin:0; padding:0 "> 118: </pre>
<pre style="margin:0; padding:0 "> 119:   // LSU signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 120:   logic        lsu_addr_incr_req;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 121:   logic [31:0] lsu_addr_last;</pre>
<pre style="margin:0; padding:0 "> 122: </pre>
<pre style="margin:0; padding:0 "> 123:   // Jump and branch target and decision (EX->IF)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 124:   logic [31:0] jump_target_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 125:   logic        branch_decision;</pre>
<pre style="margin:0; padding:0 "> 126: </pre>
<pre style="margin:0; padding:0 "> 127:   // Core busy signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 128:   logic        ctrl_busy;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 129:   logic        if_busy;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 130:   logic        lsu_busy;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 131:   logic        core_busy_d, core_busy_q;</pre>
<pre style="margin:0; padding:0 "> 132: </pre>
<pre style="margin:0; padding:0 "> 133:   // ALU Control</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 134:   alu_op_e     alu_operator_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 135:   logic [31:0] alu_operand_a_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 136:   logic [31:0] alu_operand_b_ex;</pre>
<pre style="margin:0; padding:0 "> 137: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 138:   logic [31:0] alu_adder_result_ex;    // Used to forward computed address to LSU</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 139:   logic [31:0] regfile_wdata_ex;</pre>
<pre style="margin:0; padding:0 "> 140: </pre>
<pre style="margin:0; padding:0 "> 141:   // Multiplier Control</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 142:   logic        mult_en_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 143:   logic        div_en_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 144:   md_op_e      multdiv_operator_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 145:   logic [1:0]  multdiv_signed_mode_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 146:   logic [31:0] multdiv_operand_a_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 147:   logic [31:0] multdiv_operand_b_ex;</pre>
<pre style="margin:0; padding:0 "> 148: </pre>
<pre style="margin:0; padding:0 "> 149:   // CSR control</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 150:   logic        csr_access;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 151:   logic        valid_csr_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 152:   csr_op_e     csr_op;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 153:   csr_num_e    csr_addr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 154:   logic [31:0] csr_rdata;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 155:   logic [31:0] csr_wdata;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 156:   logic        illegal_csr_insn_id;    // CSR access to non-existent register,</pre>
<pre style="margin:0; padding:0 "> 157:                                        // with wrong priviledge level,</pre>
<pre style="margin:0; padding:0 "> 158:                                        // or missing write permissions</pre>
<pre style="margin:0; padding:0 "> 159: </pre>
<pre style="margin:0; padding:0 "> 160:   // Data Memory Control</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 161:   logic        data_we_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 162:   logic [1:0]  data_type_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 163:   logic        data_sign_ext_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 164:   logic        data_req_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 165:   logic [31:0] data_wdata_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 166:   logic [31:0] regfile_wdata_lsu;</pre>
<pre style="margin:0; padding:0 "> 167: </pre>
<pre style="margin:0; padding:0 "> 168:   // stall control</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 169:   logic        id_in_ready;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 170:   logic        ex_valid;</pre>
<pre style="margin:0; padding:0 "> 171: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 172:   logic        lsu_data_valid;</pre>
<pre style="margin:0; padding:0 "> 173: </pre>
<pre style="margin:0; padding:0 "> 174:   // Signals between instruction core interface and pipe (if and id stages)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 175:   logic        instr_req_int;          // Id stage asserts a req to instruction core interface</pre>
<pre style="margin:0; padding:0 "> 176: </pre>
<pre style="margin:0; padding:0 "> 177:   // Interrupts</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 178:   logic        irq_pending;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 179:   logic        nmi_mode;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 180:   logic        csr_msip;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 181:   logic        csr_mtip;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 182:   logic        csr_meip;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 183:   logic [14:0] csr_mfip;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 184:   logic        csr_mstatus_mie;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 185:   logic [31:0] csr_mepc, csr_depc;</pre>
<pre style="margin:0; padding:0 "> 186: </pre>
<pre style="margin:0; padding:0 "> 187:   // PMP signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 188:   logic [33:0] csr_pmp_addr [PMPNumRegions];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 189:   pmp_cfg_t    csr_pmp_cfg  [PMPNumRegions];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 190:   logic        pmp_req_err  [PMP_NUM_CHAN];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 191:   logic        instr_req_out;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 192:   logic        data_req_out;</pre>
<pre style="margin:0; padding:0 "> 193: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 194:   logic        csr_save_if;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 195:   logic        csr_save_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 196:   logic        csr_restore_mret_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 197:   logic        csr_restore_dret_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 198:   logic        csr_save_cause;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 199:   logic        csr_mtvec_init;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 200:   logic [31:0] csr_mtvec;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 201:   logic [31:0] csr_mtval;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 202:   logic        csr_mstatus_tw;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 203:   priv_lvl_e   priv_mode_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 204:   priv_lvl_e   priv_mode_if;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 205:   priv_lvl_e   priv_mode_lsu;</pre>
<pre style="margin:0; padding:0 "> 206: </pre>
<pre style="margin:0; padding:0 "> 207:   // debug mode and dcsr configuration</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 208:   logic        debug_mode;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 209:   dbg_cause_e  debug_cause;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 210:   logic        debug_csr_save;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 211:   logic        debug_single_step;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 212:   logic        debug_ebreakm;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 213:   logic        debug_ebreaku;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 214:   logic        trigger_match;</pre>
<pre style="margin:0; padding:0 "> 215: </pre>
<pre style="margin:0; padding:0 "> 216:   // performance counter related signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 217:   logic        instr_ret;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 218:   logic        instr_ret_compressed;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 219:   logic        perf_imiss;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 220:   logic        perf_jump;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 221:   logic        perf_branch;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 222:   logic        perf_tbranch;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 223:   logic        perf_load;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 224:   logic        perf_store;</pre>
<pre style="margin:0; padding:0 "> 225: </pre>
<pre style="margin:0; padding:0 "> 226:   // for RVFI</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 227:   logic        illegal_insn_id, unused_illegal_insn_id; // ID stage sees an illegal instruction</pre>
<pre style="margin:0; padding:0 "> 228: </pre>
<pre style="margin:0; padding:0 "> 229:   // RISC-V Formal Interface signals</pre>
<pre style="margin:0; padding:0 "> 230: `ifdef RVFI</pre>
<pre style="margin:0; padding:0 "> 231:   logic        rvfi_intr_d;</pre>
<pre style="margin:0; padding:0 "> 232:   logic        rvfi_set_trap_pc_d;</pre>
<pre style="margin:0; padding:0 "> 233:   logic        rvfi_set_trap_pc_q;</pre>
<pre style="margin:0; padding:0 "> 234:   logic [31:0] rvfi_insn_id;</pre>
<pre style="margin:0; padding:0 "> 235:   logic [4:0]  rvfi_rs1_addr_id;</pre>
<pre style="margin:0; padding:0 "> 236:   logic [4:0]  rvfi_rs2_addr_id;</pre>
<pre style="margin:0; padding:0 "> 237:   logic [31:0] rvfi_rs1_data_d;</pre>
<pre style="margin:0; padding:0 "> 238:   logic [31:0] rvfi_rs1_data_id;</pre>
<pre style="margin:0; padding:0 "> 239:   logic [31:0] rvfi_rs1_data_q;</pre>
<pre style="margin:0; padding:0 "> 240:   logic [31:0] rvfi_rs2_data_d;</pre>
<pre style="margin:0; padding:0 "> 241:   logic [31:0] rvfi_rs2_data_id;</pre>
<pre style="margin:0; padding:0 "> 242:   logic [31:0] rvfi_rs2_data_q;</pre>
<pre style="margin:0; padding:0 "> 243:   logic [4:0]  rvfi_rd_addr_id;</pre>
<pre style="margin:0; padding:0 "> 244:   logic [4:0]  rvfi_rd_addr_q;</pre>
<pre style="margin:0; padding:0 "> 245:   logic [4:0]  rvfi_rd_addr_d;</pre>
<pre style="margin:0; padding:0 "> 246:   logic [31:0] rvfi_rd_wdata_id;</pre>
<pre style="margin:0; padding:0 "> 247:   logic [31:0] rvfi_rd_wdata_d;</pre>
<pre style="margin:0; padding:0 "> 248:   logic [31:0] rvfi_rd_wdata_q;</pre>
<pre style="margin:0; padding:0 "> 249:   logic        rvfi_rd_we_id;</pre>
<pre style="margin:0; padding:0 "> 250:   logic        rvfi_insn_new_d;</pre>
<pre style="margin:0; padding:0 "> 251:   logic        rvfi_insn_new_q;</pre>
<pre style="margin:0; padding:0 "> 252:   logic [3:0]  rvfi_mem_mask_int;</pre>
<pre style="margin:0; padding:0 "> 253:   logic [31:0] rvfi_mem_rdata_d;</pre>
<pre style="margin:0; padding:0 "> 254:   logic [31:0] rvfi_mem_rdata_q;</pre>
<pre style="margin:0; padding:0 "> 255:   logic [31:0] rvfi_mem_wdata_d;</pre>
<pre style="margin:0; padding:0 "> 256:   logic [31:0] rvfi_mem_wdata_q;</pre>
<pre style="margin:0; padding:0 "> 257:   logic [31:0] rvfi_mem_addr_d;</pre>
<pre style="margin:0; padding:0 "> 258:   logic [31:0] rvfi_mem_addr_q;</pre>
<pre style="margin:0; padding:0 "> 259: `endif</pre>
<pre style="margin:0; padding:0 "> 260: </pre>
<pre style="margin:0; padding:0 "> 261:   //////////////////////</pre>
<pre style="margin:0; padding:0 "> 262:   // Clock management //</pre>
<pre style="margin:0; padding:0 "> 263:   //////////////////////</pre>
<pre style="margin:0; padding:0 "> 264: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 265:   logic        clk;</pre>
<pre style="margin:0; padding:0 "> 266: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 267:   logic        clock_en;</pre>
<pre style="margin:0; padding:0 "> 268: </pre>
<pre style="margin:0; padding:0 "> 269:   // Before going to sleep, wait for I- and D-side</pre>
<pre style="margin:0; padding:0 "> 270:   // interfaces to finish ongoing operations.</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 271:   assign core_busy_d = ctrl_busy | if_busy | lsu_busy;</pre>
<pre style="margin:0; padding:0 "> 272: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 273:   always_ff @(posedge clk_i or negedge rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 274:     if (!rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 275:       core_busy_q <= 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 276:     end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 277:       core_busy_q <= core_busy_d;</pre>
<pre style="margin:0; padding:0 "> 278:     end</pre>
<pre style="margin:0; padding:0 "> 279:   end</pre>
<pre style="margin:0; padding:0 "> 280: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 281:   assign clock_en     = core_busy_q | debug_req_i | irq_pending | irq_nm_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 282:   assign core_sleep_o = ~clock_en;</pre>
<pre style="margin:0; padding:0 "> 283: </pre>
<pre style="margin:0; padding:0 "> 284:   // main clock gate of the core</pre>
<pre style="margin:0; padding:0 "> 285:   // generates all clocks except the one for the debug unit which is</pre>
<pre style="margin:0; padding:0 "> 286:   // independent</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 287:   prim_clock_gating core_clock_gate_i (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 288:       .clk_i     ( clk_i           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 289:       .en_i      ( clock_en        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 290:       .test_en_i ( test_en_i       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 291:       .clk_o     ( clk             )</pre>
<pre style="margin:0; padding:0 "> 292:   );</pre>
<pre style="margin:0; padding:0 "> 293: </pre>
<pre style="margin:0; padding:0 "> 294:   //////////////</pre>
<pre style="margin:0; padding:0 "> 295:   // IF stage //</pre>
<pre style="margin:0; padding:0 "> 296:   //////////////</pre>
<pre style="margin:0; padding:0 "> 297: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 298:   ibex_if_stage #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 299:       .DmHaltAddr       ( DmHaltAddr      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 300:       .DmExceptionAddr  ( DmExceptionAddr )</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 301:   ) if_stage_i (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 302:       .clk_i                    ( clk                    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 303:       .rst_ni                   ( rst_ni                 ),</pre>
<pre style="margin:0; padding:0 "> 304: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 305:       .boot_addr_i              ( boot_addr_i            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 306:       .req_i                    ( instr_req_int          ), // instruction request control</pre>
<pre style="margin:0; padding:0 "> 307: </pre>
<pre style="margin:0; padding:0 "> 308:       // instruction cache interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 309:       .instr_req_o              ( instr_req_out          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 310:       .instr_addr_o             ( instr_addr_o           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 311:       .instr_gnt_i              ( instr_gnt_i            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 312:       .instr_rvalid_i           ( instr_rvalid_i         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 313:       .instr_rdata_i            ( instr_rdata_i          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 314:       .instr_err_i              ( instr_err_i            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 315:       .instr_pmp_err_i          ( pmp_req_err[PMP_I]     ),</pre>
<pre style="margin:0; padding:0 "> 316: </pre>
<pre style="margin:0; padding:0 "> 317:       // outputs to ID stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 318:       .instr_valid_id_o         ( instr_valid_id         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 319:       .instr_new_id_o           ( instr_new_id           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 320:       .instr_rdata_id_o         ( instr_rdata_id         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 321:       .instr_rdata_c_id_o       ( instr_rdata_c_id       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 322:       .instr_is_compressed_id_o ( instr_is_compressed_id ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 323:       .instr_fetch_err_o        ( instr_fetch_err        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 324:       .illegal_c_insn_id_o      ( illegal_c_insn_id      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 325:       .pc_if_o                  ( pc_if                  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 326:       .pc_id_o                  ( pc_id                  ),</pre>
<pre style="margin:0; padding:0 "> 327: </pre>
<pre style="margin:0; padding:0 "> 328:       // control signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 329:       .instr_valid_clear_i      ( instr_valid_clear      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 330:       .pc_set_i                 ( pc_set                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 331:       .pc_mux_i                 ( pc_mux_id              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 332:       .exc_pc_mux_i             ( exc_pc_mux_id          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 333:       .exc_cause                ( exc_cause              ),</pre>
<pre style="margin:0; padding:0 "> 334: </pre>
<pre style="margin:0; padding:0 "> 335:       // jump targets</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 336:       .jump_target_ex_i         ( jump_target_ex         ),</pre>
<pre style="margin:0; padding:0 "> 337: </pre>
<pre style="margin:0; padding:0 "> 338:       // CSRs</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 339:       .csr_mepc_i               ( csr_mepc               ), // exception return address</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 340:       .csr_depc_i               ( csr_depc               ), // debug return address</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 341:       .csr_mtvec_i              ( csr_mtvec              ), // trap-vector base address</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 342:       .csr_mtvec_init_o         ( csr_mtvec_init         ),</pre>
<pre style="margin:0; padding:0 "> 343: </pre>
<pre style="margin:0; padding:0 "> 344:       // pipeline stalls</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 345:       .id_in_ready_i            ( id_in_ready            ),</pre>
<pre style="margin:0; padding:0 "> 346: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 347:       .if_busy_o                ( if_busy                ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 348:       .perf_imiss_o             ( perf_imiss             )</pre>
<pre style="margin:0; padding:0 "> 349:   );</pre>
<pre style="margin:0; padding:0 "> 350: </pre>
<pre style="margin:0; padding:0 "> 351:   // Qualify the instruction request with PMP error</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 352:   assign instr_req_o = instr_req_out & ~pmp_req_err[PMP_I];</pre>
<pre style="margin:0; padding:0 "> 353: </pre>
<pre style="margin:0; padding:0 "> 354:   //////////////</pre>
<pre style="margin:0; padding:0 "> 355:   // ID stage //</pre>
<pre style="margin:0; padding:0 "> 356:   //////////////</pre>
<pre style="margin:0; padding:0 "> 357: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 358:   ibex_id_stage #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 359:       .RV32E ( RV32E ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 360:       .RV32M ( RV32M )</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 361:   ) id_stage_i (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 362:       .clk_i                        ( clk                    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 363:       .rst_ni                       ( rst_ni                 ),</pre>
<pre style="margin:0; padding:0 "> 364: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 365:       .test_en_i                    ( test_en_i              ),</pre>
<pre style="margin:0; padding:0 "> 366: </pre>
<pre style="margin:0; padding:0 "> 367:       // Processor Enable</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 368:       .fetch_enable_i               ( fetch_enable_i         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 369:       .ctrl_busy_o                  ( ctrl_busy              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 370:       .illegal_insn_o               ( illegal_insn_id        ),</pre>
<pre style="margin:0; padding:0 "> 371: </pre>
<pre style="margin:0; padding:0 "> 372:       // from/to IF-ID pipeline register</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 373:       .instr_valid_i                ( instr_valid_id         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 374:       .instr_new_i                  ( instr_new_id           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 375:       .instr_rdata_i                ( instr_rdata_id         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 376:       .instr_rdata_c_i              ( instr_rdata_c_id       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 377:       .instr_is_compressed_i        ( instr_is_compressed_id ),</pre>
<pre style="margin:0; padding:0 "> 378: </pre>
<pre style="margin:0; padding:0 "> 379:       // Jumps and branches</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 380:       .branch_decision_i            ( branch_decision        ),</pre>
<pre style="margin:0; padding:0 "> 381: </pre>
<pre style="margin:0; padding:0 "> 382:       // IF and ID control signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 383:       .id_in_ready_o                ( id_in_ready            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 384:       .instr_valid_clear_o          ( instr_valid_clear      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 385:       .instr_req_o                  ( instr_req_int          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 386:       .pc_set_o                     ( pc_set                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 387:       .pc_mux_o                     ( pc_mux_id              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 388:       .exc_pc_mux_o                 ( exc_pc_mux_id          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 389:       .exc_cause_o                  ( exc_cause              ),</pre>
<pre style="margin:0; padding:0 "> 390: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 391:       .instr_fetch_err_i            ( instr_fetch_err        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 392:       .illegal_c_insn_i             ( illegal_c_insn_id      ),</pre>
<pre style="margin:0; padding:0 "> 393: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 394:       .pc_id_i                      ( pc_id                  ),</pre>
<pre style="margin:0; padding:0 "> 395: </pre>
<pre style="margin:0; padding:0 "> 396:       // Stalls</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 397:       .ex_valid_i                   ( ex_valid               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 398:       .lsu_valid_i                  ( lsu_data_valid         ),</pre>
<pre style="margin:0; padding:0 "> 399: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 400:       .alu_operator_ex_o            ( alu_operator_ex        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 401:       .alu_operand_a_ex_o           ( alu_operand_a_ex       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 402:       .alu_operand_b_ex_o           ( alu_operand_b_ex       ),</pre>
<pre style="margin:0; padding:0 "> 403: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 404:       .mult_en_ex_o                 ( mult_en_ex             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 405:       .div_en_ex_o                  ( div_en_ex              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 406:       .multdiv_operator_ex_o        ( multdiv_operator_ex    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 407:       .multdiv_signed_mode_ex_o     ( multdiv_signed_mode_ex ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 408:       .multdiv_operand_a_ex_o       ( multdiv_operand_a_ex   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 409:       .multdiv_operand_b_ex_o       ( multdiv_operand_b_ex   ),</pre>
<pre style="margin:0; padding:0 "> 410: </pre>
<pre style="margin:0; padding:0 "> 411:       // CSR ID/EX</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 412:       .csr_access_o                 ( csr_access             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 413:       .csr_op_o                     ( csr_op                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 414:       .csr_save_if_o                ( csr_save_if            ), // control signal to save PC</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 415:       .csr_save_id_o                ( csr_save_id            ), // control signal to save PC</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 416:       .csr_restore_mret_id_o        ( csr_restore_mret_id    ), // restore mstatus upon DRET</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 417:       .csr_restore_dret_id_o        ( csr_restore_dret_id    ), // restore mstatus upon MRET</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 418:       .csr_save_cause_o             ( csr_save_cause         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 419:       .csr_mtval_o                  ( csr_mtval              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 420:       .priv_mode_i                  ( priv_mode_id           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 421:       .csr_mstatus_tw_i             ( csr_mstatus_tw         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 422:       .illegal_csr_insn_i           ( illegal_csr_insn_id    ),</pre>
<pre style="margin:0; padding:0 "> 423: </pre>
<pre style="margin:0; padding:0 "> 424:       // LSU</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 425:       .data_req_ex_o                ( data_req_ex            ), // to load store unit</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 426:       .data_we_ex_o                 ( data_we_ex             ), // to load store unit</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 427:       .data_type_ex_o               ( data_type_ex           ), // to load store unit</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 428:       .data_sign_ext_ex_o           ( data_sign_ext_ex       ), // to load store unit</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 429:       .data_wdata_ex_o              ( data_wdata_ex          ), // to load store unit</pre>
<pre style="margin:0; padding:0 "> 430: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 431:       .lsu_addr_incr_req_i          ( lsu_addr_incr_req      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 432:       .lsu_addr_last_i              ( lsu_addr_last          ),</pre>
<pre style="margin:0; padding:0 "> 433: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 434:       .lsu_load_err_i               ( lsu_load_err           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 435:       .lsu_store_err_i              ( lsu_store_err          ),</pre>
<pre style="margin:0; padding:0 "> 436: </pre>
<pre style="margin:0; padding:0 "> 437:       // Interrupt Signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 438:       .csr_mstatus_mie_i            ( csr_mstatus_mie        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 439:       .csr_msip_i                   ( csr_msip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 440:       .csr_mtip_i                   ( csr_mtip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 441:       .csr_meip_i                   ( csr_meip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 442:       .csr_mfip_i                   ( csr_mfip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 443:       .irq_pending_i                ( irq_pending            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 444:       .irq_nm_i                     ( irq_nm_i               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 445:       .nmi_mode_o                   ( nmi_mode               ),</pre>
<pre style="margin:0; padding:0 "> 446: </pre>
<pre style="margin:0; padding:0 "> 447:       // Debug Signal</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 448:       .debug_mode_o                 ( debug_mode             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 449:       .debug_cause_o                ( debug_cause            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 450:       .debug_csr_save_o             ( debug_csr_save         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 451:       .debug_req_i                  ( debug_req_i            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 452:       .debug_single_step_i          ( debug_single_step      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 453:       .debug_ebreakm_i              ( debug_ebreakm          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 454:       .debug_ebreaku_i              ( debug_ebreaku          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 455:       .trigger_match_i              ( trigger_match          ),</pre>
<pre style="margin:0; padding:0 "> 456: </pre>
<pre style="margin:0; padding:0 "> 457:       // write data to commit in the register file</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 458:       .regfile_wdata_lsu_i          ( regfile_wdata_lsu      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 459:       .regfile_wdata_ex_i           ( regfile_wdata_ex       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 460:       .csr_rdata_i                  ( csr_rdata              ),</pre>
<pre style="margin:0; padding:0 "> 461: </pre>
<pre style="margin:0; padding:0 "> 462: `ifdef RVFI</pre>
<pre style="margin:0; padding:0 "> 463:       .rfvi_reg_raddr_ra_o          ( rvfi_rs1_addr_id       ),</pre>
<pre style="margin:0; padding:0 "> 464:       .rfvi_reg_rdata_ra_o          ( rvfi_rs1_data_id       ),</pre>
<pre style="margin:0; padding:0 "> 465:       .rfvi_reg_raddr_rb_o          ( rvfi_rs2_addr_id       ),</pre>
<pre style="margin:0; padding:0 "> 466:       .rfvi_reg_rdata_rb_o          ( rvfi_rs2_data_id       ),</pre>
<pre style="margin:0; padding:0 "> 467:       .rfvi_reg_waddr_rd_o          ( rvfi_rd_addr_id        ),</pre>
<pre style="margin:0; padding:0 "> 468:       .rfvi_reg_wdata_rd_o          ( rvfi_rd_wdata_id       ),</pre>
<pre style="margin:0; padding:0 "> 469:       .rfvi_reg_we_o                ( rvfi_rd_we_id          ),</pre>
<pre style="margin:0; padding:0 "> 470: `endif</pre>
<pre style="margin:0; padding:0 "> 471: </pre>
<pre style="margin:0; padding:0 "> 472:       // Performance Counters</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 473:       .perf_jump_o                  ( perf_jump              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 474:       .perf_branch_o                ( perf_branch            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 475:       .perf_tbranch_o               ( perf_tbranch           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 476:       .instr_ret_o                  ( instr_ret              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 477:       .instr_ret_compressed_o       ( instr_ret_compressed   )</pre>
<pre style="margin:0; padding:0 "> 478:   );</pre>
<pre style="margin:0; padding:0 "> 479: </pre>
<pre style="margin:0; padding:0 "> 480:   // for RVFI only</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 481:   assign unused_illegal_insn_id = illegal_insn_id;</pre>
<pre style="margin:0; padding:0 "> 482: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 483:   ibex_ex_block #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 484:       .RV32M                      ( RV32M                    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 485:       .MultiplierImplementation   ( MultiplierImplementation )</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 486:   ) ex_block_i (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 487:       .clk_i                      ( clk                      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 488:       .rst_ni                     ( rst_ni                   ),</pre>
<pre style="margin:0; padding:0 "> 489: </pre>
<pre style="margin:0; padding:0 "> 490:       // ALU signal from ID stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 491:       .alu_operator_i             ( alu_operator_ex          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 492:       .alu_operand_a_i            ( alu_operand_a_ex         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 493:       .alu_operand_b_i            ( alu_operand_b_ex         ),</pre>
<pre style="margin:0; padding:0 "> 494: </pre>
<pre style="margin:0; padding:0 "> 495:       // Multipler/Divider signal from ID stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 496:       .multdiv_operator_i         ( multdiv_operator_ex      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 497:       .mult_en_i                  ( mult_en_ex               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 498:       .div_en_i                   ( div_en_ex                ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 499:       .multdiv_signed_mode_i      ( multdiv_signed_mode_ex   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 500:       .multdiv_operand_a_i        ( multdiv_operand_a_ex     ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 501:       .multdiv_operand_b_i        ( multdiv_operand_b_ex     ),</pre>
<pre style="margin:0; padding:0 "> 502: </pre>
<pre style="margin:0; padding:0 "> 503:       // Outputs</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 504:       .alu_adder_result_ex_o      ( alu_adder_result_ex      ), // to LSU</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 505:       .regfile_wdata_ex_o         ( regfile_wdata_ex         ), // to ID</pre>
<pre style="margin:0; padding:0 "> 506: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 507:       .jump_target_o              ( jump_target_ex           ), // to IF</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 508:       .branch_decision_o          ( branch_decision          ), // to ID</pre>
<pre style="margin:0; padding:0 "> 509: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 510:       .ex_valid_o                 ( ex_valid                 )</pre>
<pre style="margin:0; padding:0 "> 511:   );</pre>
<pre style="margin:0; padding:0 "> 512: </pre>
<pre style="margin:0; padding:0 "> 513:   /////////////////////</pre>
<pre style="margin:0; padding:0 "> 514:   // Load/store unit //</pre>
<pre style="margin:0; padding:0 "> 515:   /////////////////////</pre>
<pre style="margin:0; padding:0 "> 516: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 517:   assign data_req_o = data_req_out & ~pmp_req_err[PMP_D];</pre>
<pre style="margin:0; padding:0 "> 518: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 519:   ibex_load_store_unit  load_store_unit_i (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 520:       .clk_i                 ( clk                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 521:       .rst_ni                ( rst_ni              ),</pre>
<pre style="margin:0; padding:0 "> 522: </pre>
<pre style="margin:0; padding:0 "> 523:       // data interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 524:       .data_req_o            ( data_req_out        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 525:       .data_gnt_i            ( data_gnt_i          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 526:       .data_rvalid_i         ( data_rvalid_i       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 527:       .data_err_i            ( data_err_i          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 528:       .data_pmp_err_i        ( pmp_req_err[PMP_D]  ),</pre>
<pre style="margin:0; padding:0 "> 529: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 530:       .data_addr_o           ( data_addr_o         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 531:       .data_we_o             ( data_we_o           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 532:       .data_be_o             ( data_be_o           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 533:       .data_wdata_o          ( data_wdata_o        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 534:       .data_rdata_i          ( data_rdata_i        ),</pre>
<pre style="margin:0; padding:0 "> 535: </pre>
<pre style="margin:0; padding:0 "> 536:       // signals to/from ID/EX stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 537:       .data_we_ex_i          ( data_we_ex          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 538:       .data_type_ex_i        ( data_type_ex        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 539:       .data_wdata_ex_i       ( data_wdata_ex       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 540:       .data_sign_ext_ex_i    ( data_sign_ext_ex    ),</pre>
<pre style="margin:0; padding:0 "> 541: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 542:       .data_rdata_ex_o       ( regfile_wdata_lsu   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 543:       .data_req_ex_i         ( data_req_ex         ),</pre>
<pre style="margin:0; padding:0 "> 544: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 545:       .adder_result_ex_i     ( alu_adder_result_ex ),</pre>
<pre style="margin:0; padding:0 "> 546: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 547:       .addr_incr_req_o       ( lsu_addr_incr_req   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 548:       .addr_last_o           ( lsu_addr_last       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 549:       .data_valid_o          ( lsu_data_valid      ),</pre>
<pre style="margin:0; padding:0 "> 550: </pre>
<pre style="margin:0; padding:0 "> 551:       // exception signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 552:       .load_err_o            ( lsu_load_err        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 553:       .store_err_o           ( lsu_store_err       ),</pre>
<pre style="margin:0; padding:0 "> 554: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 555:       .busy_o                ( lsu_busy            )</pre>
<pre style="margin:0; padding:0 "> 556:   );</pre>
<pre style="margin:0; padding:0 "> 557: </pre>
<pre style="margin:0; padding:0 "> 558: </pre>
<pre style="margin:0; padding:0 "> 559:   /////////////////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 560:   // CSRs (Control and Status Registers) //</pre>
<pre style="margin:0; padding:0 "> 561:   /////////////////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 562: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 563:   assign csr_wdata  = alu_operand_a_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 564:   assign csr_addr   = csr_num_e'(csr_access ? alu_operand_b_ex[11:0] : 12'b0);</pre>
<pre style="margin:0; padding:0 "> 565: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 566:   assign perf_load  = data_req_o & data_gnt_i & (~data_we_o);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 567:   assign perf_store = data_req_o & data_gnt_i & data_we_o;</pre>
<pre style="margin:0; padding:0 "> 568: </pre>
<pre style="margin:0; padding:0 "> 569:   // CSR access is qualified by instruction fetch error</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 570:   assign valid_csr_id = instr_new_id & ~instr_fetch_err;</pre>
<pre style="margin:0; padding:0 "> 571: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 572:   ibex_cs_registers #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 573:       .DbgTriggerEn     ( DbgTriggerEn     ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 574:       .MHPMCounterNum   ( MHPMCounterNum   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 575:       .MHPMCounterWidth ( MHPMCounterWidth ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 576:       .PMPEnable        ( PMPEnable        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 577:       .PMPGranularity   ( PMPGranularity   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 578:       .PMPNumRegions    ( PMPNumRegions    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 579:       .RV32E            ( RV32E            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 580:       .RV32M            ( RV32M            )</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 581:   ) cs_registers_i (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 582:       .clk_i                   ( clk                    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 583:       .rst_ni                  ( rst_ni                 ),</pre>
<pre style="margin:0; padding:0 "> 584: </pre>
<pre style="margin:0; padding:0 "> 585:       // Hart ID from outside</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 586:       .hart_id_i               ( hart_id_i              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 587:       .priv_mode_id_o          ( priv_mode_id           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 588:       .priv_mode_if_o          ( priv_mode_if           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 589:       .priv_mode_lsu_o         ( priv_mode_lsu          ),</pre>
<pre style="margin:0; padding:0 "> 590: </pre>
<pre style="margin:0; padding:0 "> 591:       // mtvec</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 592:       .csr_mtvec_o             ( csr_mtvec              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 593:       .csr_mtvec_init_i        ( csr_mtvec_init         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 594:       .boot_addr_i             ( boot_addr_i            ),</pre>
<pre style="margin:0; padding:0 "> 595: </pre>
<pre style="margin:0; padding:0 "> 596:       // Interface to CSRs (SRAM like)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 597:       .csr_access_i            ( csr_access             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 598:       .csr_addr_i              ( csr_addr               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 599:       .csr_wdata_i             ( csr_wdata              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 600:       .csr_op_i                ( csr_op                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 601:       .csr_rdata_o             ( csr_rdata              ),</pre>
<pre style="margin:0; padding:0 "> 602: </pre>
<pre style="margin:0; padding:0 "> 603:       // Interrupt related control signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 604:       .irq_software_i          ( irq_software_i         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 605:       .irq_timer_i             ( irq_timer_i            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 606:       .irq_external_i          ( irq_external_i         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 607:       .irq_fast_i              ( irq_fast_i             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 608:       .irq_pending_o           ( irq_pending            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 609:       .nmi_mode_i              ( nmi_mode               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 610:       .csr_msip_o              ( csr_msip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 611:       .csr_mtip_o              ( csr_mtip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 612:       .csr_meip_o              ( csr_meip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 613:       .csr_mfip_o              ( csr_mfip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 614:       .csr_mstatus_mie_o       ( csr_mstatus_mie        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 615:       .csr_mstatus_tw_o        ( csr_mstatus_tw         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 616:       .csr_mepc_o              ( csr_mepc               ),</pre>
<pre style="margin:0; padding:0 "> 617: </pre>
<pre style="margin:0; padding:0 "> 618:       // PMP</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 619:       .csr_pmp_cfg_o           ( csr_pmp_cfg            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 620:       .csr_pmp_addr_o          ( csr_pmp_addr           ),</pre>
<pre style="margin:0; padding:0 "> 621: </pre>
<pre style="margin:0; padding:0 "> 622:       // debug</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 623:       .csr_depc_o              ( csr_depc               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 624:       .debug_mode_i            ( debug_mode             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 625:       .debug_cause_i           ( debug_cause            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 626:       .debug_csr_save_i        ( debug_csr_save         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 627:       .debug_single_step_o     ( debug_single_step      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 628:       .debug_ebreakm_o         ( debug_ebreakm          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 629:       .debug_ebreaku_o         ( debug_ebreaku          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 630:       .trigger_match_o         ( trigger_match          ),</pre>
<pre style="margin:0; padding:0 "> 631: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 632:       .pc_if_i                 ( pc_if                  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 633:       .pc_id_i                 ( pc_id                  ),</pre>
<pre style="margin:0; padding:0 "> 634: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 635:       .csr_save_if_i           ( csr_save_if            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 636:       .csr_save_id_i           ( csr_save_id            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 637:       .csr_restore_mret_i      ( csr_restore_mret_id    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 638:       .csr_restore_dret_i      ( csr_restore_dret_id    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 639:       .csr_save_cause_i        ( csr_save_cause         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 640:       .csr_mcause_i            ( exc_cause              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 641:       .csr_mtval_i             ( csr_mtval              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 642:       .illegal_csr_insn_o      ( illegal_csr_insn_id    ),</pre>
<pre style="margin:0; padding:0 "> 643: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 644:       .instr_new_id_i          ( valid_csr_id           ),</pre>
<pre style="margin:0; padding:0 "> 645: </pre>
<pre style="margin:0; padding:0 "> 646:       // performance counter related signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 647:       .instr_ret_i             ( instr_ret              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 648:       .instr_ret_compressed_i  ( instr_ret_compressed   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 649:       .imiss_i                 ( perf_imiss             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 650:       .pc_set_i                ( pc_set                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 651:       .jump_i                  ( perf_jump              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 652:       .branch_i                ( perf_branch            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 653:       .branch_taken_i          ( perf_tbranch           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 654:       .mem_load_i              ( perf_load              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 655:       .mem_store_i             ( perf_store             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 656:       .lsu_busy_i              ( lsu_busy               )</pre>
<pre style="margin:0; padding:0 "> 657:   );</pre>
<pre style="margin:0; padding:0 "> 658: </pre>
<pre id="id659" style="background-color: #FFB6C1; margin:0; padding:0 "> 659:   if (PMPEnable) begin : g_pmp</pre>
<pre id="id660" style="background-color: #FFB6C1; margin:0; padding:0 "> 660:     logic [33:0] pmp_req_addr [PMP_NUM_CHAN];</pre>
<pre id="id661" style="background-color: #FFB6C1; margin:0; padding:0 "> 661:     pmp_req_e    pmp_req_type [PMP_NUM_CHAN];</pre>
<pre id="id662" style="background-color: #FFB6C1; margin:0; padding:0 "> 662:     priv_lvl_e   pmp_priv_lvl [PMP_NUM_CHAN];</pre>
<pre style="margin:0; padding:0 "> 663: </pre>
<pre id="id664" style="background-color: #FFB6C1; margin:0; padding:0 "> 664:     assign pmp_req_addr[PMP_I] = {2'b00,instr_addr_o[31:0]};</pre>
<pre id="id665" style="background-color: #FFB6C1; margin:0; padding:0 "> 665:     assign pmp_req_type[PMP_I] = PMP_ACC_EXEC;</pre>
<pre id="id666" style="background-color: #FFB6C1; margin:0; padding:0 "> 666:     assign pmp_priv_lvl[PMP_I] = priv_mode_if;</pre>
<pre id="id667" style="background-color: #FFB6C1; margin:0; padding:0 "> 667:     assign pmp_req_addr[PMP_D] = {2'b00,data_addr_o[31:0]};</pre>
<pre id="id668" style="background-color: #FFB6C1; margin:0; padding:0 "> 668:     assign pmp_req_type[PMP_D] = data_we_o ? PMP_ACC_WRITE : PMP_ACC_READ;</pre>
<pre id="id669" style="background-color: #FFB6C1; margin:0; padding:0 "> 669:     assign pmp_priv_lvl[PMP_D] = priv_mode_lsu;</pre>
<pre style="margin:0; padding:0 "> 670: </pre>
<pre id="id671" style="background-color: #FFB6C1; margin:0; padding:0 "> 671:     ibex_pmp #(</pre>
<pre id="id672" style="background-color: #FFB6C1; margin:0; padding:0 "> 672:         .PMPGranularity        ( PMPGranularity ),</pre>
<pre id="id673" style="background-color: #FFB6C1; margin:0; padding:0 "> 673:         .PMPNumChan            ( PMP_NUM_CHAN   ),</pre>
<pre id="id674" style="background-color: #FFB6C1; margin:0; padding:0 "> 674:         .PMPNumRegions         ( PMPNumRegions  )</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 675:     ) pmp_i (</pre>
<pre id="id676" style="background-color: #FFB6C1; margin:0; padding:0 "> 676:         .clk_i                 ( clk            ),</pre>
<pre id="id677" style="background-color: #FFB6C1; margin:0; padding:0 "> 677:         .rst_ni                ( rst_ni         ),</pre>
<pre style="margin:0; padding:0 "> 678:         // Interface to CSRs</pre>
<pre id="id679" style="background-color: #FFB6C1; margin:0; padding:0 "> 679:         .csr_pmp_cfg_i         ( csr_pmp_cfg    ),</pre>
<pre id="id680" style="background-color: #FFB6C1; margin:0; padding:0 "> 680:         .csr_pmp_addr_i        ( csr_pmp_addr   ),</pre>
<pre id="id681" style="background-color: #FFB6C1; margin:0; padding:0 "> 681:         .priv_mode_i           ( pmp_priv_lvl   ),</pre>
<pre style="margin:0; padding:0 "> 682:         // Access checking channels</pre>
<pre id="id683" style="background-color: #FFB6C1; margin:0; padding:0 "> 683:         .pmp_req_addr_i        ( pmp_req_addr   ),</pre>
<pre id="id684" style="background-color: #FFB6C1; margin:0; padding:0 "> 684:         .pmp_req_type_i        ( pmp_req_type   ),</pre>
<pre id="id685" style="background-color: #FFB6C1; margin:0; padding:0 "> 685:         .pmp_req_err_o         ( pmp_req_err    )</pre>
<pre style="margin:0; padding:0 "> 686:     );</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 687:   end else begin : g_no_pmp</pre>
<pre style="margin:0; padding:0 "> 688:     // Unused signal tieoff</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 689:     priv_lvl_e unused_priv_lvl_if, unused_priv_lvl_ls;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 690:     logic [33:0] unused_csr_pmp_addr [PMPNumRegions];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 691:     pmp_cfg_t    unused_csr_pmp_cfg  [PMPNumRegions];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 692:     assign unused_priv_lvl_if = priv_mode_if;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 693:     assign unused_priv_lvl_ls = priv_mode_lsu;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 694:     assign unused_csr_pmp_addr = csr_pmp_addr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 695:     assign unused_csr_pmp_cfg = csr_pmp_cfg;</pre>
<pre style="margin:0; padding:0 "> 696: </pre>
<pre style="margin:0; padding:0 "> 697:     // Output tieoff</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 698:     assign pmp_req_err[PMP_I] = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 699:     assign pmp_req_err[PMP_D] = 1'b0;</pre>
<pre style="margin:0; padding:0 "> 700:   end</pre>
<pre style="margin:0; padding:0 "> 701: </pre>
<pre style="margin:0; padding:0 "> 702: `ifdef RVFI</pre>
<pre style="margin:0; padding:0 "> 703:   always_ff @(posedge clk or negedge rst_ni) begin</pre>
<pre style="margin:0; padding:0 "> 704:     if (!rst_ni) begin</pre>
<pre style="margin:0; padding:0 "> 705:       rvfi_halt              <= '0;</pre>
<pre style="margin:0; padding:0 "> 706:       rvfi_trap              <= '0;</pre>
<pre style="margin:0; padding:0 "> 707:       rvfi_intr              <= '0;</pre>
<pre style="margin:0; padding:0 "> 708:       rvfi_order             <= '0;</pre>
<pre style="margin:0; padding:0 "> 709:       rvfi_insn              <= '0;</pre>
<pre style="margin:0; padding:0 "> 710:       rvfi_mode              <= {PRIV_LVL_M};</pre>
<pre style="margin:0; padding:0 "> 711:       rvfi_rs1_addr          <= '0;</pre>
<pre style="margin:0; padding:0 "> 712:       rvfi_rs2_addr          <= '0;</pre>
<pre style="margin:0; padding:0 "> 713:       rvfi_pc_rdata          <= '0;</pre>
<pre style="margin:0; padding:0 "> 714:       rvfi_pc_wdata          <= '0;</pre>
<pre style="margin:0; padding:0 "> 715:       rvfi_mem_rmask         <= '0;</pre>
<pre style="margin:0; padding:0 "> 716:       rvfi_mem_wmask         <= '0;</pre>
<pre style="margin:0; padding:0 "> 717:       rvfi_valid             <= '0;</pre>
<pre style="margin:0; padding:0 "> 718:       rvfi_rs1_rdata         <= '0;</pre>
<pre style="margin:0; padding:0 "> 719:       rvfi_rs2_rdata         <= '0;</pre>
<pre style="margin:0; padding:0 "> 720:       rvfi_rd_wdata          <= '0;</pre>
<pre style="margin:0; padding:0 "> 721:       rvfi_rd_addr           <= '0;</pre>
<pre style="margin:0; padding:0 "> 722:       rvfi_mem_rdata         <= '0;</pre>
<pre style="margin:0; padding:0 "> 723:       rvfi_mem_wdata         <= '0;</pre>
<pre style="margin:0; padding:0 "> 724:       rvfi_mem_addr          <= '0;</pre>
<pre style="margin:0; padding:0 "> 725:     end else begin</pre>
<pre style="margin:0; padding:0 "> 726:       rvfi_halt              <= '0;</pre>
<pre style="margin:0; padding:0 "> 727:       rvfi_trap              <= illegal_insn_id;</pre>
<pre style="margin:0; padding:0 "> 728:       rvfi_intr              <= rvfi_intr_d;</pre>
<pre style="margin:0; padding:0 "> 729:       rvfi_order             <= rvfi_order + 64'(rvfi_valid);</pre>
<pre style="margin:0; padding:0 "> 730:       rvfi_insn              <= rvfi_insn_id;</pre>
<pre style="margin:0; padding:0 "> 731:       rvfi_mode              <= {priv_mode_id};</pre>
<pre style="margin:0; padding:0 "> 732:       rvfi_rs1_addr          <= rvfi_rs1_addr_id;</pre>
<pre style="margin:0; padding:0 "> 733:       rvfi_rs2_addr          <= rvfi_rs2_addr_id;</pre>
<pre style="margin:0; padding:0 "> 734:       rvfi_pc_rdata          <= pc_id;</pre>
<pre style="margin:0; padding:0 "> 735:       rvfi_pc_wdata          <= pc_if;</pre>
<pre style="margin:0; padding:0 "> 736:       rvfi_mem_rmask         <= rvfi_mem_mask_int;</pre>
<pre style="margin:0; padding:0 "> 737:       rvfi_mem_wmask         <= data_we_o ? rvfi_mem_mask_int : 4'b0000;</pre>
<pre style="margin:0; padding:0 "> 738:       rvfi_valid             <= instr_ret;</pre>
<pre style="margin:0; padding:0 "> 739:       rvfi_rs1_rdata         <= rvfi_rs1_data_d;</pre>
<pre style="margin:0; padding:0 "> 740:       rvfi_rs2_rdata         <= rvfi_rs2_data_d;</pre>
<pre style="margin:0; padding:0 "> 741:       rvfi_rd_wdata          <= rvfi_rd_wdata_d;</pre>
<pre style="margin:0; padding:0 "> 742:       rvfi_rd_addr           <= rvfi_rd_addr_d;</pre>
<pre style="margin:0; padding:0 "> 743:       rvfi_mem_rdata         <= rvfi_mem_rdata_d;</pre>
<pre style="margin:0; padding:0 "> 744:       rvfi_mem_wdata         <= rvfi_mem_wdata_d;</pre>
<pre style="margin:0; padding:0 "> 745:       rvfi_mem_addr          <= rvfi_mem_addr_d;</pre>
<pre style="margin:0; padding:0 "> 746:     end</pre>
<pre style="margin:0; padding:0 "> 747:   end</pre>
<pre style="margin:0; padding:0 "> 748: </pre>
<pre style="margin:0; padding:0 "> 749:   // Keep the mem data stable for each instruction cycle</pre>
<pre style="margin:0; padding:0 "> 750:   always_comb begin</pre>
<pre style="margin:0; padding:0 "> 751:     if (rvfi_insn_new_d && lsu_data_valid) begin</pre>
<pre style="margin:0; padding:0 "> 752:       rvfi_mem_addr_d  = alu_adder_result_ex;</pre>
<pre style="margin:0; padding:0 "> 753:       rvfi_mem_rdata_d = regfile_wdata_lsu;</pre>
<pre style="margin:0; padding:0 "> 754:       rvfi_mem_wdata_d = data_wdata_ex;</pre>
<pre style="margin:0; padding:0 "> 755:     end else begin</pre>
<pre style="margin:0; padding:0 "> 756:       rvfi_mem_addr_d  = rvfi_mem_addr_q;</pre>
<pre style="margin:0; padding:0 "> 757:       rvfi_mem_rdata_d = rvfi_mem_rdata_q;</pre>
<pre style="margin:0; padding:0 "> 758:       rvfi_mem_wdata_d = rvfi_mem_wdata_q;</pre>
<pre style="margin:0; padding:0 "> 759:     end</pre>
<pre style="margin:0; padding:0 "> 760:   end</pre>
<pre style="margin:0; padding:0 "> 761:   always_ff @(posedge clk or negedge rst_ni) begin</pre>
<pre style="margin:0; padding:0 "> 762:     if (!rst_ni) begin</pre>
<pre style="margin:0; padding:0 "> 763:       rvfi_mem_addr_q  <= '0;</pre>
<pre style="margin:0; padding:0 "> 764:       rvfi_mem_rdata_q <= '0;</pre>
<pre style="margin:0; padding:0 "> 765:       rvfi_mem_wdata_q <= '0;</pre>
<pre style="margin:0; padding:0 "> 766:     end else begin</pre>
<pre style="margin:0; padding:0 "> 767:       rvfi_mem_addr_q  <= rvfi_mem_addr_d;</pre>
<pre style="margin:0; padding:0 "> 768:       rvfi_mem_rdata_q <= rvfi_mem_rdata_d;</pre>
<pre style="margin:0; padding:0 "> 769:       rvfi_mem_wdata_q <= rvfi_mem_wdata_d;</pre>
<pre style="margin:0; padding:0 "> 770:     end</pre>
<pre style="margin:0; padding:0 "> 771:   end</pre>
<pre style="margin:0; padding:0 "> 772:   // Byte enable based on data type</pre>
<pre style="margin:0; padding:0 "> 773:   always_comb begin</pre>
<pre style="margin:0; padding:0 "> 774:     unique case (data_type_ex)</pre>
<pre style="margin:0; padding:0 "> 775:       2'b00:   rvfi_mem_mask_int = 4'b1111;</pre>
<pre style="margin:0; padding:0 "> 776:       2'b01:   rvfi_mem_mask_int = 4'b0011;</pre>
<pre style="margin:0; padding:0 "> 777:       2'b10:   rvfi_mem_mask_int = 4'b0001;</pre>
<pre style="margin:0; padding:0 "> 778:       default: rvfi_mem_mask_int = 4'b0000;</pre>
<pre style="margin:0; padding:0 "> 779:     endcase</pre>
<pre style="margin:0; padding:0 "> 780:   end</pre>
<pre style="margin:0; padding:0 "> 781: </pre>
<pre style="margin:0; padding:0 "> 782:   always_comb begin</pre>
<pre style="margin:0; padding:0 "> 783:     if (instr_is_compressed_id) begin</pre>
<pre style="margin:0; padding:0 "> 784:       rvfi_insn_id = {16'b0, instr_rdata_c_id};</pre>
<pre style="margin:0; padding:0 "> 785:     end else begin</pre>
<pre style="margin:0; padding:0 "> 786:       rvfi_insn_id = instr_rdata_id;</pre>
<pre style="margin:0; padding:0 "> 787:     end</pre>
<pre style="margin:0; padding:0 "> 788:   end</pre>
<pre style="margin:0; padding:0 "> 789: </pre>
<pre style="margin:0; padding:0 "> 790:   // Source register data are kept stable for each instruction cycle</pre>
<pre style="margin:0; padding:0 "> 791:   always_comb begin</pre>
<pre style="margin:0; padding:0 "> 792:     if (instr_new_id) begin</pre>
<pre style="margin:0; padding:0 "> 793:       rvfi_rs1_data_d = rvfi_rs1_data_id;</pre>
<pre style="margin:0; padding:0 "> 794:       rvfi_rs2_data_d = rvfi_rs2_data_id;</pre>
<pre style="margin:0; padding:0 "> 795:     end else begin</pre>
<pre style="margin:0; padding:0 "> 796:       rvfi_rs1_data_d = rvfi_rs1_data_q;</pre>
<pre style="margin:0; padding:0 "> 797:       rvfi_rs2_data_d = rvfi_rs2_data_q;</pre>
<pre style="margin:0; padding:0 "> 798:     end</pre>
<pre style="margin:0; padding:0 "> 799:   end</pre>
<pre style="margin:0; padding:0 "> 800:   always_ff @(posedge clk or negedge rst_ni) begin</pre>
<pre style="margin:0; padding:0 "> 801:     if (!rst_ni) begin</pre>
<pre style="margin:0; padding:0 "> 802:       rvfi_rs1_data_q <= '0;</pre>
<pre style="margin:0; padding:0 "> 803:       rvfi_rs2_data_q <= '0;</pre>
<pre style="margin:0; padding:0 "> 804:     end else begin</pre>
<pre style="margin:0; padding:0 "> 805:       rvfi_rs1_data_q <= rvfi_rs1_data_d;</pre>
<pre style="margin:0; padding:0 "> 806:       rvfi_rs2_data_q <= rvfi_rs2_data_d;</pre>
<pre style="margin:0; padding:0 "> 807:     end</pre>
<pre style="margin:0; padding:0 "> 808:   end</pre>
<pre style="margin:0; padding:0 "> 809: </pre>
<pre style="margin:0; padding:0 "> 810:   // RD write register is refreshed only once per cycle and</pre>
<pre style="margin:0; padding:0 "> 811:   // then it is kept stable for the cycle.</pre>
<pre style="margin:0; padding:0 "> 812:   always_comb begin</pre>
<pre style="margin:0; padding:0 "> 813:     if (rvfi_insn_new_d) begin</pre>
<pre style="margin:0; padding:0 "> 814:       if (!rvfi_rd_we_id) begin</pre>
<pre style="margin:0; padding:0 "> 815:         rvfi_rd_addr_d    = '0;</pre>
<pre style="margin:0; padding:0 "> 816:         rvfi_rd_wdata_d   = '0;</pre>
<pre style="margin:0; padding:0 "> 817:       end else begin</pre>
<pre style="margin:0; padding:0 "> 818:         rvfi_rd_addr_d = rvfi_rd_addr_id;</pre>
<pre style="margin:0; padding:0 "> 819:         if (rvfi_rd_addr_id == 5'h0) begin</pre>
<pre style="margin:0; padding:0 "> 820:           rvfi_rd_wdata_d = '0;</pre>
<pre style="margin:0; padding:0 "> 821:         end else begin</pre>
<pre style="margin:0; padding:0 "> 822:           rvfi_rd_wdata_d = rvfi_rd_wdata_id;</pre>
<pre style="margin:0; padding:0 "> 823:         end</pre>
<pre style="margin:0; padding:0 "> 824:       end</pre>
<pre style="margin:0; padding:0 "> 825:     end else begin</pre>
<pre style="margin:0; padding:0 "> 826:       rvfi_rd_addr_d    = rvfi_rd_addr_q;</pre>
<pre style="margin:0; padding:0 "> 827:       rvfi_rd_wdata_d   = rvfi_rd_wdata_q;</pre>
<pre style="margin:0; padding:0 "> 828:     end</pre>
<pre style="margin:0; padding:0 "> 829:   end</pre>
<pre style="margin:0; padding:0 "> 830:   always_ff @(posedge clk or negedge rst_ni) begin</pre>
<pre style="margin:0; padding:0 "> 831:     if (!rst_ni) begin</pre>
<pre style="margin:0; padding:0 "> 832:       rvfi_rd_addr_q    <= '0;</pre>
<pre style="margin:0; padding:0 "> 833:       rvfi_rd_wdata_q   <= '0;</pre>
<pre style="margin:0; padding:0 "> 834:     end else begin</pre>
<pre style="margin:0; padding:0 "> 835:       rvfi_rd_addr_q    <= rvfi_rd_addr_d;</pre>
<pre style="margin:0; padding:0 "> 836:       rvfi_rd_wdata_q   <= rvfi_rd_wdata_d;</pre>
<pre style="margin:0; padding:0 "> 837:     end</pre>
<pre style="margin:0; padding:0 "> 838:   end</pre>
<pre style="margin:0; padding:0 "> 839: </pre>
<pre style="margin:0; padding:0 "> 840:   always_comb begin</pre>
<pre style="margin:0; padding:0 "> 841:     if (instr_new_id) begin</pre>
<pre style="margin:0; padding:0 "> 842:       rvfi_insn_new_d = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 843:     end else begin</pre>
<pre style="margin:0; padding:0 "> 844:       rvfi_insn_new_d = rvfi_insn_new_q;</pre>
<pre style="margin:0; padding:0 "> 845:     end</pre>
<pre style="margin:0; padding:0 "> 846:   end</pre>
<pre style="margin:0; padding:0 "> 847:   always_ff @(posedge clk or negedge rst_ni) begin</pre>
<pre style="margin:0; padding:0 "> 848:     if (!rst_ni) begin</pre>
<pre style="margin:0; padding:0 "> 849:       rvfi_insn_new_q <= 1'b0;</pre>
<pre style="margin:0; padding:0 "> 850:     end else begin</pre>
<pre style="margin:0; padding:0 "> 851:       if (instr_ret) begin</pre>
<pre style="margin:0; padding:0 "> 852:         rvfi_insn_new_q <= 1'b0;</pre>
<pre style="margin:0; padding:0 "> 853:       end else begin</pre>
<pre style="margin:0; padding:0 "> 854:         rvfi_insn_new_q <= rvfi_insn_new_d;</pre>
<pre style="margin:0; padding:0 "> 855:       end</pre>
<pre style="margin:0; padding:0 "> 856:     end</pre>
<pre style="margin:0; padding:0 "> 857:   end</pre>
<pre style="margin:0; padding:0 "> 858: </pre>
<pre style="margin:0; padding:0 "> 859:   // generate rvfi_intr_d</pre>
<pre style="margin:0; padding:0 "> 860:   assign rvfi_intr_d = rvfi_set_trap_pc_q & rvfi_insn_new_d;</pre>
<pre style="margin:0; padding:0 "> 861: </pre>
<pre style="margin:0; padding:0 "> 862:   always_comb begin</pre>
<pre style="margin:0; padding:0 "> 863:     rvfi_set_trap_pc_d = rvfi_set_trap_pc_q;</pre>
<pre style="margin:0; padding:0 "> 864: </pre>
<pre style="margin:0; padding:0 "> 865:     if (pc_set && pc_mux_id == PC_EXC &&</pre>
<pre style="margin:0; padding:0 "> 866:         (exc_pc_mux_id == EXC_PC_EXC || exc_pc_mux_id == EXC_PC_IRQ)) begin</pre>
<pre style="margin:0; padding:0 "> 867:       // PC is set to enter a trap handler</pre>
<pre style="margin:0; padding:0 "> 868:       rvfi_set_trap_pc_d = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 869:     end else if (rvfi_set_trap_pc_q && instr_ret) begin</pre>
<pre style="margin:0; padding:0 "> 870:       // first instruction has been executed after PC is set to trap handler</pre>
<pre style="margin:0; padding:0 "> 871:       rvfi_set_trap_pc_d = 1'b0;</pre>
<pre style="margin:0; padding:0 "> 872:     end</pre>
<pre style="margin:0; padding:0 "> 873:   end</pre>
<pre style="margin:0; padding:0 "> 874: </pre>
<pre style="margin:0; padding:0 "> 875:   always_ff @(posedge clk or negedge rst_ni) begin</pre>
<pre style="margin:0; padding:0 "> 876:     if (!rst_ni) begin</pre>
<pre style="margin:0; padding:0 "> 877:       rvfi_set_trap_pc_q <= 1'b0;</pre>
<pre style="margin:0; padding:0 "> 878:     end else begin</pre>
<pre style="margin:0; padding:0 "> 879:       rvfi_set_trap_pc_q <= rvfi_set_trap_pc_d;</pre>
<pre style="margin:0; padding:0 "> 880:     end</pre>
<pre style="margin:0; padding:0 "> 881:   end</pre>
<pre style="margin:0; padding:0 "> 882: </pre>
<pre style="margin:0; padding:0 "> 883: `endif</pre>
<pre style="margin:0; padding:0 "> 884: </pre>
<pre style="margin:0; padding:0 "> 885: endmodule</pre>
<pre style="margin:0; padding:0 "> 886: </pre>
</body>
</html>
