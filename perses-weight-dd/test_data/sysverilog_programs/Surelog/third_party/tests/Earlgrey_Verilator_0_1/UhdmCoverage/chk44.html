
<!DOCTYPE html>
<html>
<head>
<style>
body {

}
p {
font-size: 14px;
}</style>
<h3>../src/lowrisc_ip_pwrmgr_0.1/rtl/pwrmgr.sv Cov: 100% </h3>
<pre style="margin:0; padding:0 ">   1: // Copyright lowRISC contributors.</pre>
<pre style="margin:0; padding:0 ">   2: // Licensed under the Apache License, Version 2.0, see LICENSE for details.</pre>
<pre style="margin:0; padding:0 ">   3: // SPDX-License-Identifier: Apache-2.0</pre>
<pre style="margin:0; padding:0 ">   4: //</pre>
<pre style="margin:0; padding:0 ">   5: // Power Manager</pre>
<pre style="margin:0; padding:0 ">   6: //</pre>
<pre style="margin:0; padding:0 ">   7: </pre>
<pre style="margin:0; padding:0 ">   8: `include "prim_assert.sv"</pre>
<pre style="margin:0; padding:0 ">   9: </pre>
<pre style="margin:0; padding:0 ">  10: module pwrmgr import pwrmgr_pkg::*;</pre>
<pre style="margin:0; padding:0 ">  11: (</pre>
<pre style="margin:0; padding:0 ">  12:   // Clocks and resets</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  13:   input clk_slow_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  14:   input clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  15:   input rst_slow_ni,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  16:   input rst_ni,</pre>
<pre style="margin:0; padding:0 ">  17: </pre>
<pre style="margin:0; padding:0 ">  18:   // Bus Interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  19:   input  tlul_pkg::tl_h2d_t tl_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  20:   output tlul_pkg::tl_d2h_t tl_o,</pre>
<pre style="margin:0; padding:0 ">  21: </pre>
<pre style="margin:0; padding:0 ">  22:   // AST interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  23:   input  pwr_ast_rsp_t pwr_ast_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  24:   output pwr_ast_req_t pwr_ast_o,</pre>
<pre style="margin:0; padding:0 ">  25: </pre>
<pre style="margin:0; padding:0 ">  26:   // rstmgr interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  27:   input  pwr_rst_rsp_t pwr_rst_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  28:   output pwr_rst_req_t pwr_rst_o,</pre>
<pre style="margin:0; padding:0 ">  29: </pre>
<pre style="margin:0; padding:0 ">  30:   // clkmgr interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  31:   output pwr_clk_req_t pwr_clk_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  32:   input  pwr_clk_rsp_t pwr_clk_i,</pre>
<pre style="margin:0; padding:0 ">  33: </pre>
<pre style="margin:0; padding:0 ">  34:   // otp interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  35:   input  pwr_otp_rsp_t pwr_otp_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  36:   output pwr_otp_req_t pwr_otp_o,</pre>
<pre style="margin:0; padding:0 ">  37: </pre>
<pre style="margin:0; padding:0 ">  38:   // life cycle interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  39:   input  pwr_lc_rsp_t pwr_lc_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  40:   output pwr_lc_req_t pwr_lc_o,</pre>
<pre style="margin:0; padding:0 ">  41: </pre>
<pre style="margin:0; padding:0 ">  42:   // flash interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  43:   input  pwr_flash_t pwr_flash_i,</pre>
<pre style="margin:0; padding:0 ">  44: </pre>
<pre style="margin:0; padding:0 ">  45:   // processor interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  46:   input  pwr_cpu_t pwr_cpu_i,</pre>
<pre style="margin:0; padding:0 ">  47: </pre>
<pre style="margin:0; padding:0 ">  48:   // peripherals interface, includes pinmux</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  49:   input  pwr_peri_t pwr_peri_i,</pre>
<pre style="margin:0; padding:0 ">  50: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  51:   output intr_wakeup_o</pre>
<pre style="margin:0; padding:0 ">  52: </pre>
<pre style="margin:0; padding:0 ">  53: );</pre>
<pre style="margin:0; padding:0 ">  54: </pre>
<pre style="margin:0; padding:0 ">  55:   import pwrmgr_reg_pkg::*;</pre>
<pre style="margin:0; padding:0 ">  56: </pre>
<pre style="margin:0; padding:0 ">  57:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  58:   ///  clk_i domain declarations</pre>
<pre style="margin:0; padding:0 ">  59:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  60: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  61:   pwrmgr_reg2hw_t reg2hw;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  62:   pwrmgr_hw2reg_t hw2reg;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  63:   pwr_peri_t peri_reqs_masked;</pre>
<pre style="margin:0; padding:0 ">  64: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  65:   logic req_pwrup;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  66:   logic ack_pwrup;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  67:   logic req_pwrdn;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  68:   logic ack_pwrdn;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  69:   pwrup_cause_e pwrup_cause;</pre>
<pre style="margin:0; padding:0 ">  70: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  71:   logic capture_en_pulse; // begin capture wakeup causes</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  72:   logic low_power_fall_through;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  73:   logic low_power_abort;</pre>
<pre style="margin:0; padding:0 ">  74: </pre>
<pre style="margin:0; padding:0 ">  75:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  76:   ///  clk_slow_i domain declarations</pre>
<pre style="margin:0; padding:0 ">  77:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  78: </pre>
<pre style="margin:0; padding:0 ">  79:   // Captured signals</pre>
<pre style="margin:0; padding:0 ">  80:   // These signals, though on clk_i domain, are safe for clk_slow_i to use</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  81:   pwrmgr_reg2hw_wakeup_en_reg_t slow_wakeup_en;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  82:   pwrmgr_reg2hw_reset_en_reg_t slow_reset_en;</pre>
<pre style="margin:0; padding:0 ">  83: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  84:   pwr_ast_rsp_t slow_ast;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  85:   pwr_peri_t slow_peri_reqs, slow_peri_reqs_masked;</pre>
<pre style="margin:0; padding:0 ">  86: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  87:   pwrup_cause_e slow_pwrup_cause;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  88:   logic slow_pwrup_cause_toggle;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  89:   logic slow_req_pwrup;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  90:   logic slow_ack_pwrup;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  91:   logic slow_req_pwrdn;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  92:   logic slow_ack_pwrdn;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  93:   logic slow_main_pd_n;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  94:   logic slow_io_clk_en;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  95:   logic slow_core_clk_en;</pre>
<pre style="margin:0; padding:0 ">  96: </pre>
<pre style="margin:0; padding:0 ">  97:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  98:   ///  Register module</pre>
<pre style="margin:0; padding:0 ">  99:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 100: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 101:   logic low_power_hint;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 102:   logic lowpwr_cfg_wen;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 103:   logic clr_hint;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 104:   logic wkup;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 105:   logic clr_cfg_lock;</pre>
<pre style="margin:0; padding:0 "> 106: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 107:   pwrmgr_reg_top i_reg (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 108:     .clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 109:     .rst_ni,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 110:     .tl_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 111:     .tl_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 112:     .reg2hw,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 113:     .hw2reg,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 114:     .devmode_i  (1'b1)</pre>
<pre style="margin:0; padding:0 "> 115:   );</pre>
<pre style="margin:0; padding:0 "> 116: </pre>
<pre style="margin:0; padding:0 "> 117:   // whenever low power entry begins, wipe the hint</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 118:   assign hw2reg.control.low_power_hint.d = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 119:   assign hw2reg.control.low_power_hint.de = clr_hint;</pre>
<pre style="margin:0; padding:0 "> 120: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 121:   always_ff @(posedge clk_i or negedge rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 122:     if (!rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 123:       lowpwr_cfg_wen <= 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 124:     end else if (!lowpwr_cfg_wen && (clr_cfg_lock || wkup)) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 125:       lowpwr_cfg_wen <= 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 126:     end else if (low_power_hint) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 127:       lowpwr_cfg_wen <= 1'b0;</pre>
<pre style="margin:0; padding:0 "> 128:     end</pre>
<pre style="margin:0; padding:0 "> 129:   end</pre>
<pre style="margin:0; padding:0 "> 130: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 131:   assign hw2reg.ctrl_cfg_regwen.d = lowpwr_cfg_wen;</pre>
<pre style="margin:0; padding:0 "> 132: </pre>
<pre style="margin:0; padding:0 "> 133:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 134:   ///  cdc handling</pre>
<pre style="margin:0; padding:0 "> 135:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 136: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 137:   pwrmgr_cdc i_cdc (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 138:     .clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 139:     .rst_ni,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 140:     .clk_slow_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 141:     .rst_slow_ni,</pre>
<pre style="margin:0; padding:0 "> 142: </pre>
<pre style="margin:0; padding:0 "> 143:     // slow domain signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 144:     .slow_req_pwrup_i(slow_req_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 145:     .slow_ack_pwrdn_i(slow_ack_pwrdn),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 146:     .slow_pwrup_cause_toggle_i(slow_pwrup_cause_toggle),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 147:     .slow_pwrup_cause_i(slow_pwrup_cause),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 148:     .slow_wakeup_en_o(slow_wakeup_en),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 149:     .slow_reset_en_o(slow_reset_en),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 150:     .slow_main_pd_no(slow_main_pd_n),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 151:     .slow_io_clk_en_o(slow_io_clk_en),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 152:     .slow_core_clk_en_o(slow_core_clk_en),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 153:     .slow_req_pwrdn_o(slow_req_pwrdn),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 154:     .slow_ack_pwrup_o(slow_ack_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 155:     .slow_ast_o(slow_ast),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 156:     .slow_peri_reqs_o(slow_peri_reqs),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 157:     .slow_peri_reqs_masked_i(slow_peri_reqs_masked),</pre>
<pre style="margin:0; padding:0 "> 158: </pre>
<pre style="margin:0; padding:0 "> 159:     // fast domain signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 160:     .req_pwrdn_i(req_pwrdn),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 161:     .ack_pwrup_i(ack_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 162:     .cfg_cdc_sync_i(reg2hw.cfg_cdc_sync.qe & reg2hw.cfg_cdc_sync.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 163:     .cdc_sync_done_o(hw2reg.cfg_cdc_sync.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 164:     .wakeup_en_i(reg2hw.wakeup_en.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 165:     .reset_en_i(reg2hw.reset_en.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 166:     .main_pd_ni(reg2hw.control.main_pd_n.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 167:     .io_clk_en_i(reg2hw.control.io_clk_en.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 168:     .core_clk_en_i(reg2hw.control.core_clk_en.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 169:     .ack_pwrdn_o(ack_pwrdn),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 170:     .req_pwrup_o(req_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 171:     .pwrup_cause_o(pwrup_cause),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 172:     .peri_reqs_o(peri_reqs_masked),</pre>
<pre style="margin:0; padding:0 "> 173: </pre>
<pre style="margin:0; padding:0 "> 174:     // AST signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 175:     .ast_i(pwr_ast_i),</pre>
<pre style="margin:0; padding:0 "> 176: </pre>
<pre style="margin:0; padding:0 "> 177:     // peripheral signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 178:     .peri_i(pwr_peri_i)</pre>
<pre style="margin:0; padding:0 "> 179:   );</pre>
<pre style="margin:0; padding:0 "> 180: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 181:   assign hw2reg.cfg_cdc_sync.d = 1'b0;</pre>
<pre style="margin:0; padding:0 "> 182: </pre>
<pre style="margin:0; padding:0 "> 183:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 184:   ///  Wakup and reset capture</pre>
<pre style="margin:0; padding:0 "> 185:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 186: </pre>
<pre style="margin:0; padding:0 "> 187:   // reset and wakeup requests are captured into the slow clock domain and then</pre>
<pre style="margin:0; padding:0 "> 188:   // fanned out to other domains as necessary.  This ensures there is not a huge</pre>
<pre style="margin:0; padding:0 "> 189:   // time gap between when the slow clk domain sees the signal vs when the fast</pre>
<pre style="margin:0; padding:0 "> 190:   // clock domains see it.  This creates redundant syncing but keeps the time</pre>
<pre style="margin:0; padding:0 "> 191:   // scale approximately the same across all domains.</pre>
<pre style="margin:0; padding:0 "> 192:   //</pre>
<pre style="margin:0; padding:0 "> 193:   // This also implies that these signals must be at least 1 clk_slow pulse long</pre>
<pre style="margin:0; padding:0 "> 194:   //</pre>
<pre style="margin:0; padding:0 "> 195:   // Since resets are not latched inside pwrmgr, there exists a corner case where</pre>
<pre style="margin:0; padding:0 "> 196:   // non-always-on reset requests may get wiped out by a graceful low power entry</pre>
<pre style="margin:0; padding:0 "> 197:   // It's not clear if this is really an issue at the moment, but something to keep</pre>
<pre style="margin:0; padding:0 "> 198:   // in mind if future changes are needed.</pre>
<pre style="margin:0; padding:0 "> 199:   //</pre>
<pre style="margin:0; padding:0 "> 200:   // Latching the reset requests is not difficult, but the bigger question is who</pre>
<pre style="margin:0; padding:0 "> 201:   // should clear it and when that should happen. If the clearing does not work</pre>
<pre style="margin:0; padding:0 "> 202:   // correctly, it is possible for the device to end up in a permanent reset loop,</pre>
<pre style="margin:0; padding:0 "> 203:   // and that would be very undesirable.</pre>
<pre style="margin:0; padding:0 "> 204: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 205:   assign slow_peri_reqs_masked.wakeups = slow_peri_reqs.wakeups & slow_wakeup_en;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 206:   assign slow_peri_reqs_masked.rstreqs = slow_peri_reqs.rstreqs & slow_reset_en;</pre>
<pre style="margin:0; padding:0 "> 207: </pre>
<pre style="margin:0; padding:0 "> 208: </pre>
<pre style="margin:0; padding:0 "> 209: </pre>
<pre style="margin:0; padding:0 "> 210: </pre>
<pre style="margin:0; padding:0 "> 211:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 212:   ///  clk_slow FSM</pre>
<pre style="margin:0; padding:0 "> 213:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 214: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 215:   pwrmgr_slow_fsm i_slow_fsm (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 216:     .clk_i                (clk_slow_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 217:     .rst_ni               (rst_slow_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 218:     .wakeup_i             (|slow_peri_reqs_masked.wakeups),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 219:     .reset_req_i          (|slow_peri_reqs_masked.rstreqs),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 220:     .ast_i                (slow_ast),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 221:     .req_pwrup_o          (slow_req_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 222:     .pwrup_cause_o        (slow_pwrup_cause),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 223:     .pwrup_cause_toggle_o (slow_pwrup_cause_toggle),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 224:     .ack_pwrup_i          (slow_ack_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 225:     .req_pwrdn_i          (slow_req_pwrdn),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 226:     .ack_pwrdn_o          (slow_ack_pwrdn),</pre>
<pre style="margin:0; padding:0 "> 227: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 228:     .main_pd_ni           (slow_main_pd_n),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 229:     .io_clk_en_i          (slow_io_clk_en),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 230:     .core_clk_en_i        (slow_core_clk_en),</pre>
<pre style="margin:0; padding:0 "> 231: </pre>
<pre style="margin:0; padding:0 "> 232:     // outputs to AST - These are on the slow clock domain</pre>
<pre style="margin:0; padding:0 "> 233:     // TBD - need to check this with partners</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 234:     .ast_o                (pwr_ast_o)</pre>
<pre style="margin:0; padding:0 "> 235:   );</pre>
<pre style="margin:0; padding:0 "> 236: </pre>
<pre style="margin:0; padding:0 "> 237: </pre>
<pre style="margin:0; padding:0 "> 238:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 239:   ///  clk FSM</pre>
<pre style="margin:0; padding:0 "> 240:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 241: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 242:   assign low_power_hint = reg2hw.control.low_power_hint.q == LowPower;</pre>
<pre style="margin:0; padding:0 "> 243: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 244:   pwrmgr_fsm i_fsm (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 245:     .clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 246:     .rst_ni,</pre>
<pre style="margin:0; padding:0 "> 247: </pre>
<pre style="margin:0; padding:0 "> 248:     // interface with slow_fsm</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 249:     .req_pwrup_i       (req_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 250:     .pwrup_cause_i     (pwrup_cause), // por, wake or reset request</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 251:     .ack_pwrup_o       (ack_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 252:     .req_pwrdn_o       (req_pwrdn),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 253:     .ack_pwrdn_i       (ack_pwrdn),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 254:     .low_power_entry_i (pwr_cpu_i.core_sleeping & low_power_hint),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 255:     .reset_req_i       (|peri_reqs_masked.rstreqs),</pre>
<pre style="margin:0; padding:0 "> 256: </pre>
<pre style="margin:0; padding:0 "> 257:     // cfg</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 258:     .main_pd_ni        (reg2hw.control.main_pd_n.q),</pre>
<pre style="margin:0; padding:0 "> 259: </pre>
<pre style="margin:0; padding:0 "> 260:     // consumed in pwrmgr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 261:     .wkup_record_o     (capture_en_pulse),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 262:     .wkup_o            (wkup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 263:     .clr_cfg_lock_o    (clr_cfg_lock),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 264:     .fall_through_o    (low_power_fall_through),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 265:     .abort_o           (low_power_abort),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 266:     .clr_hint_o        (clr_hint),</pre>
<pre style="margin:0; padding:0 "> 267: </pre>
<pre style="margin:0; padding:0 "> 268:     // rstmgr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 269:     .pwr_rst_o         (pwr_rst_o),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 270:     .pwr_rst_i         (pwr_rst_i),</pre>
<pre style="margin:0; padding:0 "> 271: </pre>
<pre style="margin:0; padding:0 "> 272:     // clkmgr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 273:     .ips_clk_en_o      (pwr_clk_o.ip_clk_en),</pre>
<pre style="margin:0; padding:0 "> 274: </pre>
<pre style="margin:0; padding:0 "> 275:     // otp</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 276:     .otp_init_o        (pwr_otp_o.otp_init),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 277:     .otp_done_i        (pwr_otp_i.otp_done),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 278:     .otp_idle_i        (pwr_otp_i.otp_idle),</pre>
<pre style="margin:0; padding:0 "> 279: </pre>
<pre style="margin:0; padding:0 "> 280:     // lc</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 281:     .lc_init_o         (pwr_lc_o.lc_init),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 282:     .lc_done_i         (pwr_lc_i.lc_done),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 283:     .lc_idle_i         (pwr_lc_i.lc_idle),</pre>
<pre style="margin:0; padding:0 "> 284: </pre>
<pre style="margin:0; padding:0 "> 285:     // flash</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 286:     .flash_idle_i       (pwr_flash_i.flash_idle)</pre>
<pre style="margin:0; padding:0 "> 287:   );</pre>
<pre style="margin:0; padding:0 "> 288: </pre>
<pre style="margin:0; padding:0 "> 289:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 290:   ///  Wakeup Info Capture</pre>
<pre style="margin:0; padding:0 "> 291:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 292: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 293:   logic wake_info_wen;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 294:   logic [TotalWakeWidth-1:0] wake_info_data;</pre>
<pre style="margin:0; padding:0 "> 295: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 296:   assign wake_info_wen = reg2hw.wake_info.abort.qe |</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 297:                          reg2hw.wake_info.fall_through.qe |</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 298:                          reg2hw.wake_info.reasons.qe;</pre>
<pre style="margin:0; padding:0 "> 299: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 300:   assign wake_info_data = {reg2hw.wake_info.abort.q,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 301:                            reg2hw.wake_info.fall_through.q,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 302:                            reg2hw.wake_info.reasons.q};</pre>
<pre style="margin:0; padding:0 "> 303: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 304:   pwrmgr_wake_info i_wake_info (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 305:     .clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 306:     .rst_ni,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 307:     .wr_i            (wake_info_wen),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 308:     .data_i          (wake_info_data),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 309:     .start_capture_i (capture_en_pulse),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 310:     .record_dis_i    (reg2hw.wake_info_capture_dis.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 311:     .wakeups_i       (peri_reqs_masked.wakeups),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 312:     .fall_through_i  (low_power_fall_through),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 313:     .abort_i         (low_power_abort),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 314:     .info_o          (hw2reg.wake_info)</pre>
<pre style="margin:0; padding:0 "> 315:   );</pre>
<pre style="margin:0; padding:0 "> 316: </pre>
<pre style="margin:0; padding:0 "> 317:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 318:   ///  Interrupts</pre>
<pre style="margin:0; padding:0 "> 319:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 320: </pre>
<pre style="margin:0; padding:0 "> 321:   // This interrupt is asserted whenever the fast FSM transitions</pre>
<pre style="margin:0; padding:0 "> 322:   // into active state.  However, it does not assert during POR</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 323:   prim_intr_hw #(.Width(1)) intr_wakeup (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 324:     .event_intr_i           (wkup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 325:     .reg2hw_intr_enable_q_i (reg2hw.intr_enable.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 326:     .reg2hw_intr_test_q_i   (reg2hw.intr_test.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 327:     .reg2hw_intr_test_qe_i  (reg2hw.intr_test.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 328:     .reg2hw_intr_state_q_i  (reg2hw.intr_state.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 329:     .hw2reg_intr_state_de_o (hw2reg.intr_state.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 330:     .hw2reg_intr_state_d_o  (hw2reg.intr_state.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 331:     .intr_o                 (intr_wakeup_o)</pre>
<pre style="margin:0; padding:0 "> 332:   );</pre>
<pre style="margin:0; padding:0 "> 333: </pre>
<pre style="margin:0; padding:0 "> 334: </pre>
<pre style="margin:0; padding:0 "> 335:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 336:   ///  Assertions</pre>
<pre style="margin:0; padding:0 "> 337:   ////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 338: </pre>
<pre style="margin:0; padding:0 "> 339: </pre>
<pre style="margin:0; padding:0 "> 340: endmodule // pwrmgr</pre>
<pre style="margin:0; padding:0 "> 341: </pre>
</body>
</html>
