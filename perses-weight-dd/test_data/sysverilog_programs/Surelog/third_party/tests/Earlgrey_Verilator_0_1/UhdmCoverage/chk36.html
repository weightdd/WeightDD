
<!DOCTYPE html>
<html>
<head>
<style>
body {

}
p {
font-size: 14px;
}</style>
<h3>../src/lowrisc_ip_aes_0.6/rtl/aes_core.sv Cov: 100% </h3>
<pre style="margin:0; padding:0 ">   1: // Copyright lowRISC contributors.</pre>
<pre style="margin:0; padding:0 ">   2: // Licensed under the Apache License, Version 2.0, see LICENSE for details.</pre>
<pre style="margin:0; padding:0 ">   3: // SPDX-License-Identifier: Apache-2.0</pre>
<pre style="margin:0; padding:0 ">   4: //</pre>
<pre style="margin:0; padding:0 ">   5: // AES core implementation</pre>
<pre style="margin:0; padding:0 ">   6: </pre>
<pre style="margin:0; padding:0 ">   7: `include "prim_assert.sv"</pre>
<pre style="margin:0; padding:0 ">   8: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">   9: module aes_core #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  10:   parameter bit AES192Enable = 1,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  11:   parameter     SBoxImpl     = "lut"</pre>
<pre style="margin:0; padding:0 ">  12: ) (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  13:   input  logic                     clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  14:   input  logic                     rst_ni,</pre>
<pre style="margin:0; padding:0 ">  15: </pre>
<pre style="margin:0; padding:0 ">  16:   // PRNG Interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  17:   output logic                     prng_data_req_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  18:   input  logic                     prng_data_ack_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  19:   input  logic [63:0]              prng_data_i,</pre>
<pre style="margin:0; padding:0 ">  20: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  21:   output logic                     prng_reseed_req_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  22:   input  logic                     prng_reseed_ack_i,</pre>
<pre style="margin:0; padding:0 ">  23: </pre>
<pre style="margin:0; padding:0 ">  24:   // Bus Interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  25:   input  aes_reg_pkg::aes_reg2hw_t reg2hw,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  26:   output aes_reg_pkg::aes_hw2reg_t hw2reg</pre>
<pre style="margin:0; padding:0 ">  27: );</pre>
<pre style="margin:0; padding:0 ">  28: </pre>
<pre style="margin:0; padding:0 ">  29:   import aes_reg_pkg::*;</pre>
<pre style="margin:0; padding:0 ">  30:   import aes_pkg::*;</pre>
<pre style="margin:0; padding:0 ">  31: </pre>
<pre style="margin:0; padding:0 ">  32:   // Signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  33:   logic                 ctrl_qe;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  34:   logic                 ctrl_we;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  35:   aes_op_e              aes_op_d, aes_op_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  36:   aes_mode_e            aes_mode;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  37:   aes_mode_e            aes_mode_d, aes_mode_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  38:   ciph_op_e             cipher_op;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  39:   key_len_e             key_len;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  40:   key_len_e             key_len_d, key_len_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  41:   logic                 manual_operation_q;</pre>
<pre style="margin:0; padding:0 ">  42: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  43:   logic [3:0][3:0][7:0] state_in;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  44:   si_sel_e              state_in_sel;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  45:   logic [3:0][3:0][7:0] add_state_in;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  46:   add_si_sel_e          add_state_in_sel;</pre>
<pre style="margin:0; padding:0 ">  47: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  48:   logic [3:0][3:0][7:0] state_init;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  49:   logic [3:0][3:0][7:0] state_done;</pre>
<pre style="margin:0; padding:0 ">  50: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  51:   logic     [7:0][31:0] key_init;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  52:   logic     [7:0]       key_init_qe;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  53:   logic     [7:0][31:0] key_init_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  54:   logic     [7:0][31:0] key_init_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  55:   logic     [7:0]       key_init_we;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  56:   key_init_sel_e        key_init_sel;</pre>
<pre style="margin:0; padding:0 ">  57: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  58:   logic     [3:0][31:0] iv;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  59:   logic     [3:0]       iv_qe;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  60:   logic     [7:0][15:0] iv_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  61:   logic     [7:0][15:0] iv_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  62:   logic     [7:0]       iv_we;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  63:   iv_sel_e              iv_sel;</pre>
<pre style="margin:0; padding:0 ">  64: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  65:   logic     [7:0][15:0] ctr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  66:   logic     [7:0]       ctr_we;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  67:   logic                 ctr_incr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  68:   logic                 ctr_ready;</pre>
<pre style="margin:0; padding:0 ">  69: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  70:   logic     [3:0][31:0] data_in_prev_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  71:   logic     [3:0][31:0] data_in_prev_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  72:   logic                 data_in_prev_we;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  73:   dip_sel_e             data_in_prev_sel;</pre>
<pre style="margin:0; padding:0 ">  74: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  75:   logic     [3:0][31:0] data_in;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  76:   logic     [3:0]       data_in_qe;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  77:   logic                 data_in_we;</pre>
<pre style="margin:0; padding:0 ">  78: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  79:   logic [3:0][3:0][7:0] add_state_out;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  80:   add_so_sel_e          add_state_out_sel;</pre>
<pre style="margin:0; padding:0 ">  81: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  82:   logic     [3:0][31:0] data_out_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  83:   logic     [3:0][31:0] data_out_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  84:   logic                 data_out_we;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  85:   logic           [3:0] data_out_re;</pre>
<pre style="margin:0; padding:0 ">  86: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  87:   logic                 cipher_in_valid;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  88:   logic                 cipher_in_ready;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  89:   logic                 cipher_out_valid;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  90:   logic                 cipher_out_ready;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  91:   logic                 cipher_crypt;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  92:   logic                 cipher_crypt_busy;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  93:   logic                 cipher_dec_key_gen;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  94:   logic                 cipher_dec_key_gen_busy;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  95:   logic                 cipher_key_clear;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  96:   logic                 cipher_key_clear_busy;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  97:   logic                 cipher_data_out_clear;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  98:   logic                 cipher_data_out_clear_busy;</pre>
<pre style="margin:0; padding:0 ">  99: </pre>
<pre style="margin:0; padding:0 "> 100:   // Unused signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 101:   logic     [3:0][31:0] unused_data_out_q;</pre>
<pre style="margin:0; padding:0 "> 102: </pre>
<pre style="margin:0; padding:0 "> 103:   ////////////</pre>
<pre style="margin:0; padding:0 "> 104:   // Inputs //</pre>
<pre style="margin:0; padding:0 "> 105:   ////////////</pre>
<pre style="margin:0; padding:0 "> 106: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 107:   always_comb begin : key_init_get</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 108:     for (int i=0; i<8; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 109:       key_init[i]    = reg2hw.key[i].q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 110:       key_init_qe[i] = reg2hw.key[i].qe;</pre>
<pre style="margin:0; padding:0 "> 111:     end</pre>
<pre style="margin:0; padding:0 "> 112:   end</pre>
<pre style="margin:0; padding:0 "> 113: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 114:   always_comb begin : iv_get</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 115:     for (int i=0; i<4; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 116:       iv[i]    = reg2hw.iv[i].q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 117:       iv_qe[i] = reg2hw.iv[i].qe;</pre>
<pre style="margin:0; padding:0 "> 118:     end</pre>
<pre style="margin:0; padding:0 "> 119:   end</pre>
<pre style="margin:0; padding:0 "> 120: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 121:   always_comb begin : data_in_get</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 122:     for (int i=0; i<4; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 123:       data_in[i]    = reg2hw.data_in[i].q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 124:       data_in_qe[i] = reg2hw.data_in[i].qe;</pre>
<pre style="margin:0; padding:0 "> 125:     end</pre>
<pre style="margin:0; padding:0 "> 126:   end</pre>
<pre style="margin:0; padding:0 "> 127: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 128:   always_comb begin : data_out_get</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 129:     for (int i=0; i<4; i++) begin</pre>
<pre style="margin:0; padding:0 "> 130:       // data_out is actually hwo, but we need hrw for hwre</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 131:       unused_data_out_q[i] = reg2hw.data_out[i].q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 132:       data_out_re[i]       = reg2hw.data_out[i].re;</pre>
<pre style="margin:0; padding:0 "> 133:     end</pre>
<pre style="margin:0; padding:0 "> 134:   end</pre>
<pre style="margin:0; padding:0 "> 135: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 136:   assign aes_op_d = aes_op_e'(reg2hw.ctrl.operation.q);</pre>
<pre style="margin:0; padding:0 "> 137: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 138:   assign aes_mode = aes_mode_e'(reg2hw.ctrl.mode.q);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 139:   always_comb begin : mode_get</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 140:     unique case (aes_mode)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 141:       AES_ECB: aes_mode_d = AES_ECB;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 142:       AES_CBC: aes_mode_d = AES_CBC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 143:       AES_CTR: aes_mode_d = AES_CTR;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 144:       default: aes_mode_d = AES_ECB; // unsupported values are mapped to AES_ECB</pre>
<pre style="margin:0; padding:0 "> 145:     endcase</pre>
<pre style="margin:0; padding:0 "> 146:   end</pre>
<pre style="margin:0; padding:0 "> 147: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 148:   assign key_len = key_len_e'(reg2hw.ctrl.key_len.q);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 149:   always_comb begin : key_len_get</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 150:     unique case (key_len)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 151:       AES_128: key_len_d = AES_128;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 152:       AES_256: key_len_d = AES_256;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 153:       AES_192: key_len_d = AES192Enable ? AES_192 : AES_128;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 154:       default: key_len_d = AES_128; // unsupported values are mapped to AES_128</pre>
<pre style="margin:0; padding:0 "> 155:     endcase</pre>
<pre style="margin:0; padding:0 "> 156:   end</pre>
<pre style="margin:0; padding:0 "> 157: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 158:   assign ctrl_qe = reg2hw.ctrl.operation.qe & reg2hw.ctrl.mode.qe & reg2hw.ctrl.key_len.qe &</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 159:       reg2hw.ctrl.manual_operation.qe;</pre>
<pre style="margin:0; padding:0 "> 160: </pre>
<pre style="margin:0; padding:0 "> 161:   //////////////////////</pre>
<pre style="margin:0; padding:0 "> 162:   // Key, IV and Data //</pre>
<pre style="margin:0; padding:0 "> 163:   //////////////////////</pre>
<pre style="margin:0; padding:0 "> 164: </pre>
<pre style="margin:0; padding:0 "> 165:   // Initial Key registers</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 166:   always_comb begin : key_init_mux</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 167:     unique case (key_init_sel)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 168:       KEY_INIT_INPUT: key_init_d = key_init;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 169:       KEY_INIT_CLEAR: key_init_d = {prng_data_i, prng_data_i, prng_data_i, prng_data_i};</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 170:       default:        key_init_d = {prng_data_i, prng_data_i, prng_data_i, prng_data_i};</pre>
<pre style="margin:0; padding:0 "> 171:     endcase</pre>
<pre style="margin:0; padding:0 "> 172:   end</pre>
<pre style="margin:0; padding:0 "> 173: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 174:   always_ff @(posedge clk_i) begin : key_init_reg</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 175:     for (int i=0; i<8; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 176:       if (key_init_we[i]) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 177:         key_init_q[i] <= key_init_d[i];</pre>
<pre style="margin:0; padding:0 "> 178:       end</pre>
<pre style="margin:0; padding:0 "> 179:     end</pre>
<pre style="margin:0; padding:0 "> 180:   end</pre>
<pre style="margin:0; padding:0 "> 181: </pre>
<pre style="margin:0; padding:0 "> 182:   // IV registers</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 183:   always_comb begin : iv_mux</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 184:     unique case (iv_sel)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 185:       IV_INPUT:        iv_d = iv;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 186:       IV_DATA_OUT:     iv_d = data_out_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 187:       IV_DATA_IN_PREV: iv_d = data_in_prev_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 188:       IV_CTR:          iv_d = ctr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 189:       IV_CLEAR:        iv_d = {prng_data_i, prng_data_i};</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 190:       default:         iv_d = {prng_data_i, prng_data_i};</pre>
<pre style="margin:0; padding:0 "> 191:     endcase</pre>
<pre style="margin:0; padding:0 "> 192:   end</pre>
<pre style="margin:0; padding:0 "> 193: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 194:   always_ff @(posedge clk_i) begin : iv_reg</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 195:     for (int i=0; i<8; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 196:       if (iv_we[i]) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 197:         iv_q[i] <= iv_d[i];</pre>
<pre style="margin:0; padding:0 "> 198:       end</pre>
<pre style="margin:0; padding:0 "> 199:     end</pre>
<pre style="margin:0; padding:0 "> 200:   end</pre>
<pre style="margin:0; padding:0 "> 201: </pre>
<pre style="margin:0; padding:0 "> 202:   // Previous input data register</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 203:   always_comb begin : data_in_prev_mux</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 204:     unique case (data_in_prev_sel)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 205:       DIP_DATA_IN: data_in_prev_d = data_in;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 206:       DIP_CLEAR:   data_in_prev_d = {prng_data_i, prng_data_i};</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 207:       default:     data_in_prev_d = {prng_data_i, prng_data_i};</pre>
<pre style="margin:0; padding:0 "> 208:     endcase</pre>
<pre style="margin:0; padding:0 "> 209:   end</pre>
<pre style="margin:0; padding:0 "> 210: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 211:   always_ff @(posedge clk_i) begin : data_in_prev_reg</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 212:     if (data_in_prev_we) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 213:       data_in_prev_q <= data_in_prev_d;</pre>
<pre style="margin:0; padding:0 "> 214:     end</pre>
<pre style="margin:0; padding:0 "> 215:   end</pre>
<pre style="margin:0; padding:0 "> 216: </pre>
<pre style="margin:0; padding:0 "> 217:   /////////////</pre>
<pre style="margin:0; padding:0 "> 218:   // Counter //</pre>
<pre style="margin:0; padding:0 "> 219:   /////////////</pre>
<pre style="margin:0; padding:0 "> 220: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 221:   aes_ctr aes_ctr (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 222:     .clk_i    ( clk_i     ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 223:     .rst_ni   ( rst_ni    ),</pre>
<pre style="margin:0; padding:0 "> 224: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 225:     .incr_i   ( ctr_incr  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 226:     .ready_o  ( ctr_ready ),</pre>
<pre style="margin:0; padding:0 "> 227: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 228:     .ctr_i    ( iv_q      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 229:     .ctr_o    ( ctr       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 230:     .ctr_we_o ( ctr_we    )</pre>
<pre style="margin:0; padding:0 "> 231:   );</pre>
<pre style="margin:0; padding:0 "> 232: </pre>
<pre style="margin:0; padding:0 "> 233:   /////////////////</pre>
<pre style="margin:0; padding:0 "> 234:   // Cipher Core //</pre>
<pre style="margin:0; padding:0 "> 235:   /////////////////</pre>
<pre style="margin:0; padding:0 "> 236: </pre>
<pre style="margin:0; padding:0 "> 237:   // Cipher core operation</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 238:   assign cipher_op = (aes_mode_q == AES_ECB && aes_op_q == AES_ENC) ? CIPH_FWD :</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 239:                      (aes_mode_q == AES_ECB && aes_op_q == AES_DEC) ? CIPH_INV :</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 240:                      (aes_mode_q == AES_CBC && aes_op_q == AES_ENC) ? CIPH_FWD :</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 241:                      (aes_mode_q == AES_CBC && aes_op_q == AES_DEC) ? CIPH_INV :</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 242:                      (aes_mode_q == AES_CTR)                        ? CIPH_FWD : CIPH_FWD;</pre>
<pre style="margin:0; padding:0 "> 243: </pre>
<pre style="margin:0; padding:0 "> 244:   // Mux for state input</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 245:   always_comb begin : state_in_mux</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 246:     unique case (state_in_sel)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 247:       SI_ZERO: state_in = '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 248:       SI_DATA: state_in = aes_transpose(data_in);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 249:       default: state_in = '0;</pre>
<pre style="margin:0; padding:0 "> 250:     endcase</pre>
<pre style="margin:0; padding:0 "> 251:   end</pre>
<pre style="margin:0; padding:0 "> 252: </pre>
<pre style="margin:0; padding:0 "> 253:   // Mux for addition to state input</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 254:   always_comb begin : add_state_in_mux</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 255:     unique case (add_state_in_sel)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 256:       ADD_SI_ZERO: add_state_in = '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 257:       ADD_SI_IV:   add_state_in = aes_transpose(iv_q);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 258:       default:     add_state_in = '0;</pre>
<pre style="margin:0; padding:0 "> 259:     endcase</pre>
<pre style="margin:0; padding:0 "> 260:   end</pre>
<pre style="margin:0; padding:0 "> 261: </pre>
<pre style="margin:0; padding:0 "> 262:   // Convert input data to state format (every input data word contains one state column)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 263:   assign state_init = state_in ^ add_state_in;</pre>
<pre style="margin:0; padding:0 "> 264: </pre>
<pre style="margin:0; padding:0 "> 265:   // Cipher core</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 266:   aes_cipher_core #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 267:     .AES192Enable ( AES192Enable ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 268:     .SBoxImpl     ( SBoxImpl     )</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 269:   ) aes_cipher_core (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 270:     .clk_i            ( clk_i                      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 271:     .rst_ni           ( rst_ni                     ),</pre>
<pre style="margin:0; padding:0 "> 272: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 273:     .in_valid_i       ( cipher_in_valid            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 274:     .in_ready_o       ( cipher_in_ready            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 275:     .out_valid_o      ( cipher_out_valid           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 276:     .out_ready_i      ( cipher_out_ready           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 277:     .op_i             ( cipher_op                  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 278:     .key_len_i        ( key_len_q                  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 279:     .crypt_i          ( cipher_crypt               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 280:     .crypt_o          ( cipher_crypt_busy          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 281:     .dec_key_gen_i    ( cipher_dec_key_gen         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 282:     .dec_key_gen_o    ( cipher_dec_key_gen_busy    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 283:     .key_clear_i      ( cipher_key_clear           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 284:     .key_clear_o      ( cipher_key_clear_busy      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 285:     .data_out_clear_i ( cipher_data_out_clear      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 286:     .data_out_clear_o ( cipher_data_out_clear_busy ),</pre>
<pre style="margin:0; padding:0 "> 287: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 288:     .prng_data_i      ( prng_data_i                ),</pre>
<pre style="margin:0; padding:0 "> 289: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 290:     .state_init_i     ( state_init                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 291:     .key_init_i       ( key_init_q                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 292:     .state_o          ( state_done                 )</pre>
<pre style="margin:0; padding:0 "> 293:   );</pre>
<pre style="margin:0; padding:0 "> 294: </pre>
<pre style="margin:0; padding:0 "> 295:   // Mux for addition to state output</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 296:   always_comb begin : add_state_out_mux</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 297:     unique case (add_state_out_sel)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 298:       ADD_SO_ZERO: add_state_out = '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 299:       ADD_SO_IV:   add_state_out = aes_transpose(iv_q);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 300:       ADD_SO_DIP:  add_state_out = aes_transpose(data_in_prev_q);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 301:       default:     add_state_out = '0;</pre>
<pre style="margin:0; padding:0 "> 302:     endcase</pre>
<pre style="margin:0; padding:0 "> 303:   end</pre>
<pre style="margin:0; padding:0 "> 304: </pre>
<pre style="margin:0; padding:0 "> 305:   // Convert output state to output data format (every state column corresponds to one output word)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 306:   assign data_out_d = aes_transpose(state_done ^ add_state_out);</pre>
<pre style="margin:0; padding:0 "> 307: </pre>
<pre style="margin:0; padding:0 "> 308:   /////////////</pre>
<pre style="margin:0; padding:0 "> 309:   // Control //</pre>
<pre style="margin:0; padding:0 "> 310:   /////////////</pre>
<pre style="margin:0; padding:0 "> 311: </pre>
<pre style="margin:0; padding:0 "> 312:   // Control</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 313:   aes_control aes_control (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 314:     .clk_i                   ( clk_i                            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 315:     .rst_ni                  ( rst_ni                           ),</pre>
<pre style="margin:0; padding:0 "> 316: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 317:     .op_i                    ( aes_op_q                         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 318:     .mode_i                  ( aes_mode_q                       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 319:     .cipher_op_i             ( cipher_op                        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 320:     .manual_operation_i      ( manual_operation_q               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 321:     .start_i                 ( reg2hw.trigger.start.q           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 322:     .key_clear_i             ( reg2hw.trigger.key_clear.q       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 323:     .iv_clear_i              ( reg2hw.trigger.iv_clear.q        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 324:     .data_in_clear_i         ( reg2hw.trigger.data_in_clear.q   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 325:     .data_out_clear_i        ( reg2hw.trigger.data_out_clear.q  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 326:     .prng_reseed_i           ( reg2hw.trigger.prng_reseed.q     ),</pre>
<pre style="margin:0; padding:0 "> 327: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 328:     .key_init_qe_i           ( key_init_qe                      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 329:     .iv_qe_i                 ( iv_qe                            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 330:     .data_in_qe_i            ( data_in_qe                       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 331:     .data_out_re_i           ( data_out_re                      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 332:     .data_in_we_o            ( data_in_we                       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 333:     .data_out_we_o           ( data_out_we                      ),</pre>
<pre style="margin:0; padding:0 "> 334: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 335:     .data_in_prev_sel_o      ( data_in_prev_sel                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 336:     .data_in_prev_we_o       ( data_in_prev_we                  ),</pre>
<pre style="margin:0; padding:0 "> 337: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 338:     .state_in_sel_o          ( state_in_sel                     ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 339:     .add_state_in_sel_o      ( add_state_in_sel                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 340:     .add_state_out_sel_o     ( add_state_out_sel                ),</pre>
<pre style="margin:0; padding:0 "> 341: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 342:     .ctr_incr_o              ( ctr_incr                         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 343:     .ctr_ready_i             ( ctr_ready                        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 344:     .ctr_we_i                ( ctr_we                           ),</pre>
<pre style="margin:0; padding:0 "> 345: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 346:     .cipher_in_valid_o       ( cipher_in_valid                  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 347:     .cipher_in_ready_i       ( cipher_in_ready                  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 348:     .cipher_out_valid_i      ( cipher_out_valid                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 349:     .cipher_out_ready_o      ( cipher_out_ready                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 350:     .cipher_crypt_o          ( cipher_crypt                     ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 351:     .cipher_crypt_i          ( cipher_crypt_busy                ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 352:     .cipher_dec_key_gen_o    ( cipher_dec_key_gen               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 353:     .cipher_dec_key_gen_i    ( cipher_dec_key_gen_busy          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 354:     .cipher_key_clear_o      ( cipher_key_clear                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 355:     .cipher_key_clear_i      ( cipher_key_clear_busy            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 356:     .cipher_data_out_clear_o ( cipher_data_out_clear            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 357:     .cipher_data_out_clear_i ( cipher_data_out_clear_busy       ),</pre>
<pre style="margin:0; padding:0 "> 358: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 359:     .key_init_sel_o          ( key_init_sel                     ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 360:     .key_init_we_o           ( key_init_we                      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 361:     .iv_sel_o                ( iv_sel                           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 362:     .iv_we_o                 ( iv_we                            ),</pre>
<pre style="margin:0; padding:0 "> 363: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 364:     .prng_data_req_o         ( prng_data_req_o                  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 365:     .prng_data_ack_i         ( prng_data_ack_i                  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 366:     .prng_reseed_req_o       ( prng_reseed_req_o                ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 367:     .prng_reseed_ack_i       ( prng_reseed_ack_i                ),</pre>
<pre style="margin:0; padding:0 "> 368: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 369:     .start_o                 ( hw2reg.trigger.start.d           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 370:     .start_we_o              ( hw2reg.trigger.start.de          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 371:     .key_clear_o             ( hw2reg.trigger.key_clear.d       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 372:     .key_clear_we_o          ( hw2reg.trigger.key_clear.de      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 373:     .iv_clear_o              ( hw2reg.trigger.iv_clear.d        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 374:     .iv_clear_we_o           ( hw2reg.trigger.iv_clear.de       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 375:     .data_in_clear_o         ( hw2reg.trigger.data_in_clear.d   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 376:     .data_in_clear_we_o      ( hw2reg.trigger.data_in_clear.de  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 377:     .data_out_clear_o        ( hw2reg.trigger.data_out_clear.d  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 378:     .data_out_clear_we_o     ( hw2reg.trigger.data_out_clear.de ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 379:     .prng_reseed_o           ( hw2reg.trigger.prng_reseed.d     ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 380:     .prng_reseed_we_o        ( hw2reg.trigger.prng_reseed.de    ),</pre>
<pre style="margin:0; padding:0 "> 381: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 382:     .output_valid_o          ( hw2reg.status.output_valid.d     ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 383:     .output_valid_we_o       ( hw2reg.status.output_valid.de    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 384:     .input_ready_o           ( hw2reg.status.input_ready.d      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 385:     .input_ready_we_o        ( hw2reg.status.input_ready.de     ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 386:     .idle_o                  ( hw2reg.status.idle.d             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 387:     .idle_we_o               ( hw2reg.status.idle.de            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 388:     .stall_o                 ( hw2reg.status.stall.d            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 389:     .stall_we_o              ( hw2reg.status.stall.de           )</pre>
<pre style="margin:0; padding:0 "> 390:   );</pre>
<pre style="margin:0; padding:0 "> 391: </pre>
<pre style="margin:0; padding:0 "> 392:   // Input data register clear</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 393:   always_comb begin : data_in_reg_clear</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 394:     for (int i=0; i<4; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 395:       hw2reg.data_in[i].d  = '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 396:       hw2reg.data_in[i].de = data_in_we;</pre>
<pre style="margin:0; padding:0 "> 397:     end</pre>
<pre style="margin:0; padding:0 "> 398:   end</pre>
<pre style="margin:0; padding:0 "> 399: </pre>
<pre style="margin:0; padding:0 "> 400:   // Control register</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 401:   assign ctrl_we = ctrl_qe & hw2reg.status.idle.d;</pre>
<pre style="margin:0; padding:0 "> 402: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 403:   always_ff @(posedge clk_i or negedge rst_ni) begin : ctrl_reg</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 404:     if (!rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 405:       aes_op_q           <= AES_ENC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 406:       aes_mode_q         <= AES_ECB;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 407:       key_len_q          <= AES_128;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 408:       manual_operation_q <= '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 409:     end else if (ctrl_we) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 410:       aes_op_q           <= aes_op_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 411:       aes_mode_q         <= aes_mode_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 412:       key_len_q          <= key_len_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 413:       manual_operation_q <= reg2hw.ctrl.manual_operation.q;</pre>
<pre style="margin:0; padding:0 "> 414:     end</pre>
<pre style="margin:0; padding:0 "> 415:   end</pre>
<pre style="margin:0; padding:0 "> 416: </pre>
<pre style="margin:0; padding:0 "> 417:   /////////////</pre>
<pre style="margin:0; padding:0 "> 418:   // Outputs //</pre>
<pre style="margin:0; padding:0 "> 419:   /////////////</pre>
<pre style="margin:0; padding:0 "> 420: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 421:   always_ff @(posedge clk_i) begin : data_out_reg</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 422:     if (data_out_we) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 423:       data_out_q <= data_out_d;</pre>
<pre style="margin:0; padding:0 "> 424:     end</pre>
<pre style="margin:0; padding:0 "> 425:   end</pre>
<pre style="margin:0; padding:0 "> 426: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 427:   always_comb begin : key_reg_put</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 428:     for (int i=0; i<8; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 429:       hw2reg.key[i].d  = key_init_q[i];</pre>
<pre style="margin:0; padding:0 "> 430:     end</pre>
<pre style="margin:0; padding:0 "> 431:   end</pre>
<pre style="margin:0; padding:0 "> 432: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 433:   always_comb begin : iv_reg_put</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 434:     for (int i=0; i<4; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 435:       hw2reg.iv[i].d  = {iv_q[2*i+1], iv_q[2*i]};</pre>
<pre style="margin:0; padding:0 "> 436:     end</pre>
<pre style="margin:0; padding:0 "> 437:   end</pre>
<pre style="margin:0; padding:0 "> 438: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 439:   always_comb begin : data_out_put</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 440:     for (int i=0; i<4; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 441:       hw2reg.data_out[i].d = data_out_q[i];</pre>
<pre style="margin:0; padding:0 "> 442:     end</pre>
<pre style="margin:0; padding:0 "> 443:   end</pre>
<pre style="margin:0; padding:0 "> 444: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 445:   assign hw2reg.ctrl.mode.d    = {aes_mode_q};</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 446:   assign hw2reg.ctrl.key_len.d = {key_len_q};</pre>
<pre style="margin:0; padding:0 "> 447: </pre>
<pre style="margin:0; padding:0 "> 448:   // These fields are actually hro. But software must be able observe the current value (rw).</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 449:   assign hw2reg.ctrl.operation.d        = {aes_op_q};</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 450:   assign hw2reg.ctrl.manual_operation.d = manual_operation_q;</pre>
<pre style="margin:0; padding:0 "> 451: </pre>
<pre style="margin:0; padding:0 "> 452:   ////////////////</pre>
<pre style="margin:0; padding:0 "> 453:   // Assertions //</pre>
<pre style="margin:0; padding:0 "> 454:   ////////////////</pre>
<pre style="margin:0; padding:0 "> 455: </pre>
<pre style="margin:0; padding:0 "> 456:   // Selectors must be known/valid</pre>
<pre style="margin:0; padding:0 "> 457:   `ASSERT_KNOWN(AesKeyInitSelKnown, key_init_sel)</pre>
<pre style="margin:0; padding:0 "> 458:   `ASSERT(AesIvSelValid, iv_sel inside {</pre>
<pre style="margin:0; padding:0 "> 459:       IV_INPUT,</pre>
<pre style="margin:0; padding:0 "> 460:       IV_DATA_OUT,</pre>
<pre style="margin:0; padding:0 "> 461:       IV_DATA_IN_PREV,</pre>
<pre style="margin:0; padding:0 "> 462:       IV_CTR,</pre>
<pre style="margin:0; padding:0 "> 463:       IV_CLEAR</pre>
<pre style="margin:0; padding:0 "> 464:       })</pre>
<pre style="margin:0; padding:0 "> 465:   `ASSERT_KNOWN(AesDataInPrevSelKnown, data_in_prev_sel)</pre>
<pre style="margin:0; padding:0 "> 466:   `ASSERT(AesModeValid, aes_mode_q inside {</pre>
<pre style="margin:0; padding:0 "> 467:       AES_ECB,</pre>
<pre style="margin:0; padding:0 "> 468:       AES_CBC,</pre>
<pre style="margin:0; padding:0 "> 469:       AES_CTR</pre>
<pre style="margin:0; padding:0 "> 470:       })</pre>
<pre style="margin:0; padding:0 "> 471:   `ASSERT_KNOWN(AesOpKnown, aes_op_q)</pre>
<pre style="margin:0; padding:0 "> 472:   `ASSERT_KNOWN(AesStateInSelKnown, state_in_sel)</pre>
<pre style="margin:0; padding:0 "> 473:   `ASSERT_KNOWN(AesAddStateInSelKnown, add_state_in_sel)</pre>
<pre style="margin:0; padding:0 "> 474:   `ASSERT(AesAddStateOutSelValid, add_state_out_sel inside {</pre>
<pre style="margin:0; padding:0 "> 475:       ADD_SO_ZERO,</pre>
<pre style="margin:0; padding:0 "> 476:       ADD_SO_IV,</pre>
<pre style="margin:0; padding:0 "> 477:       ADD_SO_DIP</pre>
<pre style="margin:0; padding:0 "> 478:       })</pre>
<pre style="margin:0; padding:0 "> 479: </pre>
<pre style="margin:0; padding:0 "> 480: endmodule</pre>
<pre style="margin:0; padding:0 "> 481: </pre>
</body>
</html>
