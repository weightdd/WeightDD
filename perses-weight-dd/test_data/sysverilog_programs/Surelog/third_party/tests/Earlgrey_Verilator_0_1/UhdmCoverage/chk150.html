
<!DOCTYPE html>
<html>
<head>
<style>
body {

}
p {
font-size: 14px;
}</style>
<h3>../src/lowrisc_ibex_ibex_core_0.1/rtl/ibex_decoder.sv Cov: 99.4% </h3>
<pre style="margin:0; padding:0 ">   1: // Copyright lowRISC contributors.</pre>
<pre style="margin:0; padding:0 ">   2: // Copyright 2018 ETH Zurich and University of Bologna, see also CREDITS.md.</pre>
<pre style="margin:0; padding:0 ">   3: // Licensed under the Apache License, Version 2.0, see LICENSE for details.</pre>
<pre style="margin:0; padding:0 ">   4: // SPDX-License-Identifier: Apache-2.0</pre>
<pre style="margin:0; padding:0 ">   5: </pre>
<pre style="margin:0; padding:0 ">   6: // Source/Destination register instruction index</pre>
<pre style="margin:0; padding:0 ">   7: `define REG_S1 19:15</pre>
<pre style="margin:0; padding:0 ">   8: `define REG_S2 24:20</pre>
<pre style="margin:0; padding:0 ">   9: `define REG_S3 31:27</pre>
<pre style="margin:0; padding:0 ">  10: `define REG_D  11:07</pre>
<pre style="margin:0; padding:0 ">  11: </pre>
<pre style="margin:0; padding:0 ">  12: /**</pre>
<pre style="margin:0; padding:0 ">  13:  * Instruction decoder</pre>
<pre style="margin:0; padding:0 ">  14:  *</pre>
<pre style="margin:0; padding:0 ">  15:  * This module is fully combinatorial, clock and reset are used for</pre>
<pre style="margin:0; padding:0 ">  16:  * assertions only.</pre>
<pre style="margin:0; padding:0 ">  17:  */</pre>
<pre style="margin:0; padding:0 ">  18: </pre>
<pre style="margin:0; padding:0 ">  19: `include "prim_assert.sv"</pre>
<pre style="margin:0; padding:0 ">  20: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  21: module ibex_decoder #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  22:     parameter bit RV32E           = 0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  23:     parameter bit RV32M           = 1,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  24:     parameter bit RV32B           = 0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  25:     parameter bit BranchTargetALU = 0</pre>
<pre style="margin:0; padding:0 ">  26: ) (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  27:     input  logic                 clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  28:     input  logic                 rst_ni,</pre>
<pre style="margin:0; padding:0 ">  29: </pre>
<pre style="margin:0; padding:0 ">  30:     // to/from controller</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  31:     output logic                 illegal_insn_o,        // illegal instr encountered</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  32:     output logic                 ebrk_insn_o,           // trap instr encountered</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  33:     output logic                 mret_insn_o,           // return from exception instr</pre>
<pre style="margin:0; padding:0 ">  34:                                                         // encountered</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  35:     output logic                 dret_insn_o,           // return from debug instr encountered</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  36:     output logic                 ecall_insn_o,          // syscall instr encountered</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  37:     output logic                 wfi_insn_o,            // wait for interrupt instr encountered</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  38:     output logic                 jump_set_o,            // jump taken set signal</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  39:     input  logic                 branch_taken_i,        // registered branch decision</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  40:     output logic                 icache_inval_o,</pre>
<pre style="margin:0; padding:0 ">  41: </pre>
<pre style="margin:0; padding:0 ">  42:     // from IF-ID pipeline register</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  43:     input  logic                 instr_first_cycle_i,   // instruction read is in its first cycle</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  44:     input  logic [31:0]          instr_rdata_i,         // instruction read from memory/cache</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  45:     input  logic [31:0]          instr_rdata_alu_i,     // instruction read from memory/cache</pre>
<pre style="margin:0; padding:0 ">  46:                                                         // replicated to ease fan-out)</pre>
<pre style="margin:0; padding:0 ">  47: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  48:     input  logic                 illegal_c_insn_i,      // compressed instruction decode failed</pre>
<pre style="margin:0; padding:0 ">  49: </pre>
<pre style="margin:0; padding:0 ">  50:     // immediates</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  51:     output ibex_pkg::imm_a_sel_e  imm_a_mux_sel_o,       // immediate selection for operand a</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  52:     output ibex_pkg::imm_b_sel_e  imm_b_mux_sel_o,       // immediate selection for operand b</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  53:     output ibex_pkg::op_a_sel_e   bt_a_mux_sel_o,        // branch target selection operand a</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  54:     output ibex_pkg::imm_b_sel_e  bt_b_mux_sel_o,        // branch target selection operand b</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  55:     output logic [31:0]           imm_i_type_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  56:     output logic [31:0]           imm_s_type_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  57:     output logic [31:0]           imm_b_type_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  58:     output logic [31:0]           imm_u_type_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  59:     output logic [31:0]           imm_j_type_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  60:     output logic [31:0]           zimm_rs1_type_o,</pre>
<pre style="margin:0; padding:0 ">  61: </pre>
<pre style="margin:0; padding:0 ">  62:     // register file</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  63:     output ibex_pkg::rf_wd_sel_e rf_wdata_sel_o,   // RF write data selection</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  64:     output logic                 rf_we_o,          // write enable for regfile</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  65:     output logic [4:0]           rf_raddr_a_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  66:     output logic [4:0]           rf_raddr_b_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  67:     output logic [4:0]           rf_waddr_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  68:     output logic                 rf_ren_a_o,          // Instruction reads from RF addr A</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  69:     output logic                 rf_ren_b_o,          // Instruction reads from RF addr B</pre>
<pre style="margin:0; padding:0 ">  70: </pre>
<pre style="margin:0; padding:0 ">  71:     // ALU</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  72:     output ibex_pkg::alu_op_e    alu_operator_o,        // ALU operation selection</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  73:     output ibex_pkg::op_a_sel_e  alu_op_a_mux_sel_o,    // operand a selection: reg value, PC,</pre>
<pre style="margin:0; padding:0 ">  74:                                                         // immediate or zero</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  75:     output ibex_pkg::op_b_sel_e  alu_op_b_mux_sel_o,    // operand b selection: reg value or</pre>
<pre style="margin:0; padding:0 ">  76:                                                         // immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  77:     output logic                 alu_multicycle_o,      // ternary bitmanip instruction</pre>
<pre style="margin:0; padding:0 ">  78: </pre>
<pre style="margin:0; padding:0 ">  79:     // MULT & DIV</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  80:     output logic                 mult_en_o,             // perform integer multiplication</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  81:     output logic                 div_en_o,              // perform integer division or remainder</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  82:     output logic                 mult_sel_o,            // as above but static, for data muxes</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  83:     output logic                 div_sel_o,             // as above but static, for data muxes</pre>
<pre style="margin:0; padding:0 ">  84: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  85:     output ibex_pkg::md_op_e     multdiv_operator_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  86:     output logic [1:0]           multdiv_signed_mode_o,</pre>
<pre style="margin:0; padding:0 ">  87: </pre>
<pre style="margin:0; padding:0 ">  88:     // CSRs</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  89:     output logic                 csr_access_o,          // access to CSR</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  90:     output ibex_pkg::csr_op_e    csr_op_o,              // operation to perform on CSR</pre>
<pre style="margin:0; padding:0 ">  91: </pre>
<pre style="margin:0; padding:0 ">  92:     // LSU</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  93:     output logic                 data_req_o,            // start transaction to data memory</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  94:     output logic                 data_we_o,             // write enable</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  95:     output logic [1:0]           data_type_o,           // size of transaction: byte, half</pre>
<pre style="margin:0; padding:0 ">  96:                                                         // word or word</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  97:     output logic                 data_sign_extension_o, // sign extension for data read from</pre>
<pre style="margin:0; padding:0 ">  98:                                                         // memory</pre>
<pre style="margin:0; padding:0 ">  99: </pre>
<pre style="margin:0; padding:0 "> 100:     // jump/branches</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 101:     output logic                 jump_in_dec_o,         // jump is being calculated in ALU</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 102:     output logic                 branch_in_dec_o</pre>
<pre style="margin:0; padding:0 "> 103: );</pre>
<pre style="margin:0; padding:0 "> 104: </pre>
<pre style="margin:0; padding:0 "> 105:   import ibex_pkg::*;</pre>
<pre style="margin:0; padding:0 "> 106: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 107:   logic        illegal_insn;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 108:   logic        illegal_reg_rv32e;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 109:   logic        csr_illegal;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 110:   logic        rf_we;</pre>
<pre style="margin:0; padding:0 "> 111: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 112:   logic [31:0] instr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 113:   logic [31:0] instr_alu;</pre>
<pre style="margin:0; padding:0 "> 114: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 115:   logic        use_rs3;</pre>
<pre style="margin:0; padding:0 "> 116: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 117:   csr_op_e     csr_op;</pre>
<pre style="margin:0; padding:0 "> 118: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 119:   opcode_e     opcode;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 120:   opcode_e     opcode_alu;</pre>
<pre style="margin:0; padding:0 "> 121: </pre>
<pre style="margin:0; padding:0 "> 122:   // To help timing the flops containing the current instruction are replicated to reduce fan-out.</pre>
<pre style="margin:0; padding:0 "> 123:   // instr_alu is used to determine the ALU control logic and associated operand/imm select signals</pre>
<pre style="margin:0; padding:0 "> 124:   // as the ALU is often on the more critical timing paths. instr is used for everything else.</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 125:   assign instr     = instr_rdata_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 126:   assign instr_alu = instr_rdata_alu_i;</pre>
<pre style="margin:0; padding:0 "> 127: </pre>
<pre style="margin:0; padding:0 "> 128:   //////////////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 129:   // Register and immediate selection //</pre>
<pre style="margin:0; padding:0 "> 130:   //////////////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 131: </pre>
<pre style="margin:0; padding:0 "> 132:   // immediate extraction and sign extension</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 133:   assign imm_i_type_o = { {20{instr[31]}}, instr[31:20] };</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 134:   assign imm_s_type_o = { {20{instr[31]}}, instr[31:25], instr[11:7] };</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 135:   assign imm_b_type_o = { {19{instr[31]}}, instr[31], instr[7], instr[30:25], instr[11:8], 1'b0 };</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 136:   assign imm_u_type_o = { instr[31:12], 12'b0 };</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 137:   assign imm_j_type_o = { {12{instr[31]}}, instr[19:12], instr[20], instr[30:21], 1'b0 };</pre>
<pre style="margin:0; padding:0 "> 138: </pre>
<pre style="margin:0; padding:0 "> 139:   // immediate for CSR manipulation (zero extended)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 140:   assign zimm_rs1_type_o = { 27'b0, instr[`REG_S1] }; // rs1</pre>
<pre style="margin:0; padding:0 "> 141: </pre>
<pre style="margin:0; padding:0 "> 142:   // source registers</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 143:   assign rf_raddr_a_o = use_rs3 ? instr[`REG_S3] : instr[`REG_S1]; // rs3 / rs1</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 144:   assign rf_raddr_b_o = instr[`REG_S2]; // rs2</pre>
<pre style="margin:0; padding:0 "> 145: </pre>
<pre style="margin:0; padding:0 "> 146:   // destination register</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 147:   assign rf_waddr_o   = instr[`REG_D]; // rd</pre>
<pre style="margin:0; padding:0 "> 148: </pre>
<pre style="margin:0; padding:0 "> 149:   ////////////////////</pre>
<pre style="margin:0; padding:0 "> 150:   // Register check //</pre>
<pre style="margin:0; padding:0 "> 151:   ////////////////////</pre>
<pre id="id152" style="background-color: #FFB6C1; margin:0; padding:0 "> 152:   if (RV32E) begin : gen_rv32e_reg_check_active</pre>
<pre id="id153" style="background-color: #FFB6C1; margin:0; padding:0 "> 153:     assign illegal_reg_rv32e = ((rf_raddr_a_o[4] & (alu_op_a_mux_sel_o == OP_A_REG_A)) |</pre>
<pre id="id154" style="background-color: #FFB6C1; margin:0; padding:0 "> 154:                                 (rf_raddr_b_o[4] & (alu_op_b_mux_sel_o == OP_B_REG_B)) |</pre>
<pre id="id155" style="background-color: #FFB6C1; margin:0; padding:0 "> 155:                                 (rf_waddr_o[4]   & rf_we));</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 156:   end else begin : gen_rv32e_reg_check_inactive</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 157:     assign illegal_reg_rv32e = 1'b0;</pre>
<pre style="margin:0; padding:0 "> 158:   end</pre>
<pre style="margin:0; padding:0 "> 159: </pre>
<pre style="margin:0; padding:0 "> 160:   ///////////////////////</pre>
<pre style="margin:0; padding:0 "> 161:   // CSR operand check //</pre>
<pre style="margin:0; padding:0 "> 162:   ///////////////////////</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 163:   always_comb begin : csr_operand_check</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 164:     csr_op_o = csr_op;</pre>
<pre style="margin:0; padding:0 "> 165: </pre>
<pre style="margin:0; padding:0 "> 166:     // CSRRSI/CSRRCI must not write 0 to CSRs (uimm[4:0]=='0)</pre>
<pre style="margin:0; padding:0 "> 167:     // CSRRS/CSRRC must not write from x0 to CSRs (rs1=='0)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 168:     if ((csr_op == CSR_OP_SET || csr_op == CSR_OP_CLEAR) &&</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 169:         instr[`REG_S1] == '0) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 170:       csr_op_o = CSR_OP_READ;</pre>
<pre style="margin:0; padding:0 "> 171:     end</pre>
<pre style="margin:0; padding:0 "> 172:   end</pre>
<pre style="margin:0; padding:0 "> 173: </pre>
<pre style="margin:0; padding:0 "> 174:   /////////////</pre>
<pre style="margin:0; padding:0 "> 175:   // Decoder //</pre>
<pre style="margin:0; padding:0 "> 176:   /////////////</pre>
<pre style="margin:0; padding:0 "> 177: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 178:   always_comb begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 179:     jump_in_dec_o         = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 180:     jump_set_o            = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 181:     branch_in_dec_o       = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 182:     icache_inval_o        = 1'b0;</pre>
<pre style="margin:0; padding:0 "> 183: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 184:     multdiv_operator_o    = MD_OP_MULL;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 185:     multdiv_signed_mode_o = 2'b00;</pre>
<pre style="margin:0; padding:0 "> 186: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 187:     rf_wdata_sel_o        = RF_WD_EX;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 188:     rf_we                 = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 189:     rf_ren_a_o            = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 190:     rf_ren_b_o            = 1'b0;</pre>
<pre style="margin:0; padding:0 "> 191: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 192:     csr_access_o          = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 193:     csr_illegal           = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 194:     csr_op                = CSR_OP_READ;</pre>
<pre style="margin:0; padding:0 "> 195: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 196:     data_we_o             = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 197:     data_type_o           = 2'b00;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 198:     data_sign_extension_o = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 199:     data_req_o            = 1'b0;</pre>
<pre style="margin:0; padding:0 "> 200: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 201:     illegal_insn          = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 202:     ebrk_insn_o           = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 203:     mret_insn_o           = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 204:     dret_insn_o           = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 205:     ecall_insn_o          = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 206:     wfi_insn_o            = 1'b0;</pre>
<pre style="margin:0; padding:0 "> 207: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 208:     opcode                = opcode_e'(instr[6:0]);</pre>
<pre style="margin:0; padding:0 "> 209: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 210:     unique case (opcode)</pre>
<pre style="margin:0; padding:0 "> 211: </pre>
<pre style="margin:0; padding:0 "> 212:       ///////////</pre>
<pre style="margin:0; padding:0 "> 213:       // Jumps //</pre>
<pre style="margin:0; padding:0 "> 214:       ///////////</pre>
<pre style="margin:0; padding:0 "> 215: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 216:       OPCODE_JAL: begin   // Jump and Link</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 217:         jump_in_dec_o      = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 218: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 219:         if (instr_first_cycle_i) begin</pre>
<pre style="margin:0; padding:0 "> 220:           // Calculate jump target (and store PC + 4 if BranchTargetALU is configured)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 221:           rf_we            = BranchTargetALU;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 222:           jump_set_o       = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 223:         end else begin</pre>
<pre style="margin:0; padding:0 "> 224:           // Calculate and store PC+4</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 225:           rf_we            = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 226:         end</pre>
<pre style="margin:0; padding:0 "> 227:       end</pre>
<pre style="margin:0; padding:0 "> 228: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 229:       OPCODE_JALR: begin  // Jump and Link Register</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 230:         jump_in_dec_o      = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 231: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 232:         if (instr_first_cycle_i) begin</pre>
<pre style="margin:0; padding:0 "> 233:           // Calculate jump target (and store PC + 4 if BranchTargetALU is configured)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 234:           rf_we            = BranchTargetALU;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 235:           jump_set_o       = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 236:         end else begin</pre>
<pre style="margin:0; padding:0 "> 237:           // Calculate and store PC+4</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 238:           rf_we            = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 239:         end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 240:         if (instr[14:12] != 3'b0) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 241:           illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 242:         end</pre>
<pre style="margin:0; padding:0 "> 243: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 244:         rf_ren_a_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 245:       end</pre>
<pre style="margin:0; padding:0 "> 246: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 247:       OPCODE_BRANCH: begin // Branch</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 248:         branch_in_dec_o       = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 249:         // Check branch condition selection</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 250:         unique case (instr[14:12])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 251:           3'b000,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 252:           3'b001,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 253:           3'b100,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 254:           3'b101,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 255:           3'b110,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 256:           3'b111:  illegal_insn = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 257:           default: illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 258:         endcase</pre>
<pre style="margin:0; padding:0 "> 259: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 260:         rf_ren_a_o = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 261:         rf_ren_b_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 262:       end</pre>
<pre style="margin:0; padding:0 "> 263: </pre>
<pre style="margin:0; padding:0 "> 264:       ////////////////</pre>
<pre style="margin:0; padding:0 "> 265:       // Load/store //</pre>
<pre style="margin:0; padding:0 "> 266:       ////////////////</pre>
<pre style="margin:0; padding:0 "> 267: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 268:       OPCODE_STORE: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 269:         rf_ren_a_o         = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 270:         rf_ren_b_o         = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 271:         data_req_o         = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 272:         data_we_o          = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 273: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 274:         if (instr[14]) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 275:           illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 276:         end</pre>
<pre style="margin:0; padding:0 "> 277: </pre>
<pre style="margin:0; padding:0 "> 278:         // store size</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 279:         unique case (instr[13:12])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 280:           2'b00:   data_type_o  = 2'b10; // sb</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 281:           2'b01:   data_type_o  = 2'b01; // sh</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 282:           2'b10:   data_type_o  = 2'b00; // sw</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 283:           default: illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 284:         endcase</pre>
<pre style="margin:0; padding:0 "> 285:       end</pre>
<pre style="margin:0; padding:0 "> 286: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 287:       OPCODE_LOAD: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 288:         rf_ren_a_o          = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 289:         data_req_o          = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 290:         data_type_o         = 2'b00;</pre>
<pre style="margin:0; padding:0 "> 291: </pre>
<pre style="margin:0; padding:0 "> 292:         // sign/zero extension</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 293:         data_sign_extension_o = ~instr[14];</pre>
<pre style="margin:0; padding:0 "> 294: </pre>
<pre style="margin:0; padding:0 "> 295:         // load size</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 296:         unique case (instr[13:12])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 297:           2'b00: data_type_o = 2'b10; // lb(u)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 298:           2'b01: data_type_o = 2'b01; // lh(u)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 299:           2'b10: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 300:             data_type_o = 2'b00;      // lw</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 301:             if (instr[14]) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 302:               illegal_insn = 1'b1;    // lwu does not exist</pre>
<pre style="margin:0; padding:0 "> 303:             end</pre>
<pre style="margin:0; padding:0 "> 304:           end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 305:           default: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 306:             illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 307:           end</pre>
<pre style="margin:0; padding:0 "> 308:         endcase</pre>
<pre style="margin:0; padding:0 "> 309:       end</pre>
<pre style="margin:0; padding:0 "> 310: </pre>
<pre style="margin:0; padding:0 "> 311:       /////////</pre>
<pre style="margin:0; padding:0 "> 312:       // ALU //</pre>
<pre style="margin:0; padding:0 "> 313:       /////////</pre>
<pre style="margin:0; padding:0 "> 314: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 315:       OPCODE_LUI: begin  // Load Upper Immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 316:         rf_we            = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 317:       end</pre>
<pre style="margin:0; padding:0 "> 318: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 319:       OPCODE_AUIPC: begin  // Add Upper Immediate to PC</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 320:         rf_we            = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 321:       end</pre>
<pre style="margin:0; padding:0 "> 322: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 323:       OPCODE_OP_IMM: begin // Register-Immediate ALU Operations</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 324:         rf_ren_a_o       = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 325:         rf_we            = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 326: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 327:         unique case (instr[14:12])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 328:           3'b000,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 329:           3'b010,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 330:           3'b011,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 331:           3'b100,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 332:           3'b110,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 333:           3'b111: illegal_insn = 1'b0;</pre>
<pre style="margin:0; padding:0 "> 334: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 335:           3'b001: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 336:             unique case (instr[31:27])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 337:               5'b0_0000: illegal_insn = 1'b0;                      // slli</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 338:               5'b0_0100,                                           // sloi</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 339:               5'b0_1001,                                           // sbclri</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 340:               5'b0_0101,                                           // sbseti</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 341:               5'b0_1101: illegal_insn = RV32B ? 1'b0 : 1'b1;       // sbinvi</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 342:               5'b0_0001: if (instr[26] == 1'b0) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 343:                 illegal_insn = RV32B ? 1'b0 : 1'b1;                // shfl</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 344:               end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 345:                 illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 346:               end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 347:               5'b0_1100: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 348:                 unique case(instr[26:20])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 349:                   7'b000_0000,                                     // clz</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 350:                   7'b000_0001,                                     // ctz</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 351:                   7'b000_0010,                                     // pcnt</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 352:                   7'b000_0100,                                     // sext.b</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 353:                   7'b000_0101,                                     // sext.h</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 354:                   7'b001_0000,                                     // crc32.b</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 355:                   7'b001_0001,                                     // crc32.h</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 356:                   7'b001_0010,                                     // crc32.w</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 357:                   7'b001_1000,                                     // crc32c.b</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 358:                   7'b001_1001,                                     // crc32c.h</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 359:                   7'b001_1010: illegal_insn = RV32B ? 1'b0 : 1'b1; // crc32c.w</pre>
<pre style="margin:0; padding:0 "> 360: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 361:                   default: illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 362:                 endcase</pre>
<pre style="margin:0; padding:0 "> 363:               end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 364:               default : illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 365:             endcase</pre>
<pre style="margin:0; padding:0 "> 366:           end</pre>
<pre style="margin:0; padding:0 "> 367: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 368:           3'b101: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 369:             if (instr[26]) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 370:               illegal_insn = RV32B ? 1'b0 : 1'b1;                  // fsri</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 371:             end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 372:               unique case (instr[31:27])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 373:                 5'b0_0000,                                         // srli</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 374:                 5'b0_1000: illegal_insn = 1'b0;                    // srai</pre>
<pre style="margin:0; padding:0 "> 375: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 376:                 5'b0_0100,                                         // sroi</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 377:                 5'b0_1100,                                         // rori</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 378:                 5'b0_1001: illegal_insn = RV32B ? 1'b0 : 1'b1;     // sbexti</pre>
<pre style="margin:0; padding:0 "> 379: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 380:                 5'b0_1101,                                         // grevi</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 381:                 5'b0_0101: illegal_insn = RV32B ? 1'b0 : 1'b1;     // gorci</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 382:                 5'b0_0001: if (instr[26] == 1'b0) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 383:                   illegal_insn = RV32B ? 1'b0 : 1'b1;              // unshfl</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 384:                 end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 385:                   illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 386:                 end</pre>
<pre style="margin:0; padding:0 "> 387: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 388:                 default: illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 389:               endcase</pre>
<pre style="margin:0; padding:0 "> 390:             end</pre>
<pre style="margin:0; padding:0 "> 391:           end</pre>
<pre style="margin:0; padding:0 "> 392: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 393:           default: illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 394:         endcase</pre>
<pre style="margin:0; padding:0 "> 395:       end</pre>
<pre style="margin:0; padding:0 "> 396: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 397:       OPCODE_OP: begin  // Register-Register ALU operation</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 398:         rf_ren_a_o      = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 399:         rf_ren_b_o      = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 400:         rf_we           = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 401:         if ({instr[26], instr[13:12]} == {1'b1, 2'b01}) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 402:           illegal_insn = RV32B ? 1'b0 : 1'b1; // cmix / cmov / fsl / fsr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 403:         end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 404:           unique case ({instr[31:25], instr[14:12]})</pre>
<pre style="margin:0; padding:0 "> 405:             // RV32I ALU operations</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 406:             {7'b000_0000, 3'b000},</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 407:             {7'b010_0000, 3'b000},</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 408:             {7'b000_0000, 3'b010},</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 409:             {7'b000_0000, 3'b011},</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 410:             {7'b000_0000, 3'b100},</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 411:             {7'b000_0000, 3'b110},</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 412:             {7'b000_0000, 3'b111},</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 413:             {7'b000_0000, 3'b001},</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 414:             {7'b000_0000, 3'b101},</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 415:             {7'b010_0000, 3'b101}: illegal_insn = 1'b0;</pre>
<pre style="margin:0; padding:0 "> 416: </pre>
<pre style="margin:0; padding:0 "> 417:             // RV32B zbb</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 418:             {7'b010_0000, 3'b111}, // andn</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 419:             {7'b010_0000, 3'b110}, // orn</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 420:             {7'b010_0000, 3'b100}, // xnor</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 421:             {7'b001_0000, 3'b001}, // slo</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 422:             {7'b001_0000, 3'b101}, // sro</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 423:             {7'b011_0000, 3'b001}, // rol</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 424:             {7'b011_0000, 3'b101}, // ror</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 425:             {7'b000_0101, 3'b100}, // min</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 426:             {7'b000_0101, 3'b101}, // max</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 427:             {7'b000_0101, 3'b110}, // minu</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 428:             {7'b000_0101, 3'b111}, // maxu</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 429:             {7'b000_0100, 3'b100}, // pack</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 430:             {7'b010_0100, 3'b100}, // packu</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 431:             {7'b000_0100, 3'b111}, // packh</pre>
<pre style="margin:0; padding:0 "> 432:             // RV32B zbs</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 433:             {7'b010_0100, 3'b001}, // sbclr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 434:             {7'b001_0100, 3'b001}, // sbset</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 435:             {7'b011_0100, 3'b001}, // sbinv</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 436:             {7'b010_0100, 3'b101}, // sbext</pre>
<pre style="margin:0; padding:0 "> 437:             // RV32B zbe</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 438:             {7'b010_0100, 3'b110}, // bdep</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 439:             {7'b000_0100, 3'b110}, // bext</pre>
<pre style="margin:0; padding:0 "> 440:             // RV32B zbp</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 441:             {7'b011_0100, 3'b101}, // grev</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 442:             {7'b001_0100, 3'b101}, // gorc</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 443:             {7'b000_0100, 3'b001}, // shfl</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 444:             {7'b000_0100, 3'b101}, // unshfl</pre>
<pre style="margin:0; padding:0 "> 445:             // RV32B zbf</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 446:             {7'b010_0100, 3'b111}, // bfp</pre>
<pre style="margin:0; padding:0 "> 447:             // RV32B zbc</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 448:             {7'b000_0101, 3'b001}, // clmul</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 449:             {7'b000_0101, 3'b010}, // clmulr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 450:             {7'b000_0101, 3'b011}: illegal_insn = RV32B ? 1'b0 : 1'b1; // clmulh</pre>
<pre style="margin:0; padding:0 "> 451: </pre>
<pre style="margin:0; padding:0 "> 452:             // RV32M instructions</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 453:             {7'b000_0001, 3'b000}: begin // mul</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 454:               multdiv_operator_o    = MD_OP_MULL;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 455:               multdiv_signed_mode_o = 2'b00;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 456:               illegal_insn          = RV32M ? 1'b0 : 1'b1;</pre>
<pre style="margin:0; padding:0 "> 457:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 458:             {7'b000_0001, 3'b001}: begin // mulh</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 459:               multdiv_operator_o    = MD_OP_MULH;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 460:               multdiv_signed_mode_o = 2'b11;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 461:               illegal_insn          = RV32M ? 1'b0 : 1'b1;</pre>
<pre style="margin:0; padding:0 "> 462:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 463:             {7'b000_0001, 3'b010}: begin // mulhsu</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 464:               multdiv_operator_o    = MD_OP_MULH;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 465:               multdiv_signed_mode_o = 2'b01;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 466:               illegal_insn          = RV32M ? 1'b0 : 1'b1;</pre>
<pre style="margin:0; padding:0 "> 467:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 468:             {7'b000_0001, 3'b011}: begin // mulhu</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 469:               multdiv_operator_o    = MD_OP_MULH;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 470:               multdiv_signed_mode_o = 2'b00;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 471:               illegal_insn          = RV32M ? 1'b0 : 1'b1;</pre>
<pre style="margin:0; padding:0 "> 472:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 473:             {7'b000_0001, 3'b100}: begin // div</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 474:               multdiv_operator_o    = MD_OP_DIV;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 475:               multdiv_signed_mode_o = 2'b11;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 476:               illegal_insn          = RV32M ? 1'b0 : 1'b1;</pre>
<pre style="margin:0; padding:0 "> 477:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 478:             {7'b000_0001, 3'b101}: begin // divu</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 479:               multdiv_operator_o    = MD_OP_DIV;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 480:               multdiv_signed_mode_o = 2'b00;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 481:               illegal_insn          = RV32M ? 1'b0 : 1'b1;</pre>
<pre style="margin:0; padding:0 "> 482:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 483:             {7'b000_0001, 3'b110}: begin // rem</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 484:               multdiv_operator_o    = MD_OP_REM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 485:               multdiv_signed_mode_o = 2'b11;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 486:               illegal_insn          = RV32M ? 1'b0 : 1'b1;</pre>
<pre style="margin:0; padding:0 "> 487:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 488:             {7'b000_0001, 3'b111}: begin // remu</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 489:               multdiv_operator_o    = MD_OP_REM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 490:               multdiv_signed_mode_o = 2'b00;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 491:               illegal_insn          = RV32M ? 1'b0 : 1'b1;</pre>
<pre style="margin:0; padding:0 "> 492:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 493:             default: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 494:               illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 495:             end</pre>
<pre style="margin:0; padding:0 "> 496:           endcase</pre>
<pre style="margin:0; padding:0 "> 497:         end</pre>
<pre style="margin:0; padding:0 "> 498:       end</pre>
<pre style="margin:0; padding:0 "> 499: </pre>
<pre style="margin:0; padding:0 "> 500:       /////////////</pre>
<pre style="margin:0; padding:0 "> 501:       // Special //</pre>
<pre style="margin:0; padding:0 "> 502:       /////////////</pre>
<pre style="margin:0; padding:0 "> 503: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 504:       OPCODE_MISC_MEM: begin</pre>
<pre style="margin:0; padding:0 "> 505:         // For now, treat the FENCE (funct3 == 000) instruction as a NOP.  This may not be correct</pre>
<pre style="margin:0; padding:0 "> 506:         // in a system with caches and should be revisited.</pre>
<pre style="margin:0; padding:0 "> 507:         // FENCE.I will flush the IF stage and prefetch buffer (or ICache) but nothing else.</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 508:         unique case (instr[14:12])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 509:           3'b000: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 510:             rf_we           = 1'b0;</pre>
<pre style="margin:0; padding:0 "> 511:           end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 512:           3'b001: begin</pre>
<pre style="margin:0; padding:0 "> 513:             // FENCE.I is implemented as a jump to the next PC, this gives the required flushing</pre>
<pre style="margin:0; padding:0 "> 514:             // behaviour (iside prefetch buffer flushed and response to any outstanding iside</pre>
<pre style="margin:0; padding:0 "> 515:             // requests will be ignored).</pre>
<pre style="margin:0; padding:0 "> 516:             // If present, the ICache will also be flushed.</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 517:             jump_in_dec_o   = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 518: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 519:             rf_we           = 1'b0;</pre>
<pre style="margin:0; padding:0 "> 520: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 521:             if (instr_first_cycle_i) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 522:               jump_set_o       = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 523:               icache_inval_o   = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 524:             end</pre>
<pre style="margin:0; padding:0 "> 525:           end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 526:           default: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 527:             illegal_insn       = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 528:           end</pre>
<pre style="margin:0; padding:0 "> 529:         endcase</pre>
<pre style="margin:0; padding:0 "> 530:       end</pre>
<pre style="margin:0; padding:0 "> 531: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 532:       OPCODE_SYSTEM: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 533:         if (instr[14:12] == 3'b000) begin</pre>
<pre style="margin:0; padding:0 "> 534:           // non CSR related SYSTEM instructions</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 535:           unique case (instr[31:20])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 536:             12'h000:  // ECALL</pre>
<pre style="margin:0; padding:0 "> 537:               // environment (system) call</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 538:               ecall_insn_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 539: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 540:             12'h001:  // ebreak</pre>
<pre style="margin:0; padding:0 "> 541:               // debugger trap</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 542:               ebrk_insn_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 543: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 544:             12'h302:  // mret</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 545:               mret_insn_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 546: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 547:             12'h7b2:  // dret</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 548:               dret_insn_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 549: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 550:             12'h105:  // wfi</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 551:               wfi_insn_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 552: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 553:             default:</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 554:               illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 555:           endcase</pre>
<pre style="margin:0; padding:0 "> 556: </pre>
<pre style="margin:0; padding:0 "> 557:           // rs1 and rd must be 0</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 558:           if (instr[`REG_S1] != 5'b0 || instr[`REG_D] != 5'b0) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 559:             illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 560:           end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 561:         end else begin</pre>
<pre style="margin:0; padding:0 "> 562:           // instruction to read/modify CSR</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 563:           csr_access_o     = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 564:           rf_wdata_sel_o   = RF_WD_CSR;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 565:           rf_we            = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 566: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 567:           if (~instr[14]) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 568:             rf_ren_a_o         = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 569:           end</pre>
<pre style="margin:0; padding:0 "> 570: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 571:           unique case (instr[13:12])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 572:             2'b01:   csr_op = CSR_OP_WRITE;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 573:             2'b10:   csr_op = CSR_OP_SET;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 574:             2'b11:   csr_op = CSR_OP_CLEAR;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 575:             default: csr_illegal = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 576:           endcase</pre>
<pre style="margin:0; padding:0 "> 577: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 578:           illegal_insn = csr_illegal;</pre>
<pre style="margin:0; padding:0 "> 579:         end</pre>
<pre style="margin:0; padding:0 "> 580: </pre>
<pre style="margin:0; padding:0 "> 581:       end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 582:       default: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 583:         illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 584:       end</pre>
<pre style="margin:0; padding:0 "> 585:     endcase</pre>
<pre style="margin:0; padding:0 "> 586: </pre>
<pre style="margin:0; padding:0 "> 587:     // make sure illegal compressed instructions cause illegal instruction exceptions</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 588:     if (illegal_c_insn_i) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 589:       illegal_insn = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 590:     end</pre>
<pre style="margin:0; padding:0 "> 591: </pre>
<pre style="margin:0; padding:0 "> 592:     // make sure illegal instructions detected in the decoder do not propagate from decoder</pre>
<pre style="margin:0; padding:0 "> 593:     // into register file, LSU, EX, WB, CSRs, PC</pre>
<pre style="margin:0; padding:0 "> 594:     // NOTE: instructions can also be detected to be illegal inside the CSRs (upon accesses with</pre>
<pre style="margin:0; padding:0 "> 595:     // insufficient privileges), or when accessing non-available registers in RV32E,</pre>
<pre style="margin:0; padding:0 "> 596:     // these cases are not handled here</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 597:     if (illegal_insn) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 598:       rf_we           = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 599:       data_req_o      = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 600:       data_we_o       = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 601:       jump_in_dec_o   = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 602:       jump_set_o      = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 603:       branch_in_dec_o = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 604:       csr_access_o    = 1'b0;</pre>
<pre style="margin:0; padding:0 "> 605:     end</pre>
<pre style="margin:0; padding:0 "> 606:   end</pre>
<pre style="margin:0; padding:0 "> 607: </pre>
<pre style="margin:0; padding:0 "> 608:   /////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 609:   // Decoder for ALU control //</pre>
<pre style="margin:0; padding:0 "> 610:   /////////////////////////////</pre>
<pre style="margin:0; padding:0 "> 611: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 612:   always_comb begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 613:     alu_operator_o     = ALU_SLTU;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 614:     alu_op_a_mux_sel_o = OP_A_IMM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 615:     alu_op_b_mux_sel_o = OP_B_IMM;</pre>
<pre style="margin:0; padding:0 "> 616: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 617:     imm_a_mux_sel_o    = IMM_A_ZERO;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 618:     imm_b_mux_sel_o    = IMM_B_I;</pre>
<pre style="margin:0; padding:0 "> 619: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 620:     bt_a_mux_sel_o     = OP_A_CURRPC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 621:     bt_b_mux_sel_o     = IMM_B_I;</pre>
<pre style="margin:0; padding:0 "> 622: </pre>
<pre style="margin:0; padding:0 "> 623: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 624:     opcode_alu         = opcode_e'(instr_alu[6:0]);</pre>
<pre style="margin:0; padding:0 "> 625: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 626:     use_rs3            = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 627:     alu_multicycle_o   = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 628:     mult_sel_o         = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 629:     div_sel_o          = 1'b0;</pre>
<pre style="margin:0; padding:0 "> 630: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 631:     unique case (opcode_alu)</pre>
<pre style="margin:0; padding:0 "> 632: </pre>
<pre style="margin:0; padding:0 "> 633:       ///////////</pre>
<pre style="margin:0; padding:0 "> 634:       // Jumps //</pre>
<pre style="margin:0; padding:0 "> 635:       ///////////</pre>
<pre style="margin:0; padding:0 "> 636: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 637:       OPCODE_JAL: begin // Jump and Link</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 638:         if (BranchTargetALU) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 639:           bt_a_mux_sel_o = OP_A_CURRPC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 640:           bt_b_mux_sel_o = IMM_B_J;</pre>
<pre style="margin:0; padding:0 "> 641:         end</pre>
<pre style="margin:0; padding:0 "> 642: </pre>
<pre style="margin:0; padding:0 "> 643:         // Jumps take two cycles without the BTALU</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 644:         if (instr_first_cycle_i && !BranchTargetALU) begin</pre>
<pre style="margin:0; padding:0 "> 645:           // Calculate jump target</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 646:           alu_op_a_mux_sel_o  = OP_A_CURRPC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 647:           alu_op_b_mux_sel_o  = OP_B_IMM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 648:           imm_b_mux_sel_o     = IMM_B_J;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 649:           alu_operator_o      = ALU_ADD;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 650:         end else begin</pre>
<pre style="margin:0; padding:0 "> 651:           // Calculate and store PC+4</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 652:           alu_op_a_mux_sel_o  = OP_A_CURRPC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 653:           alu_op_b_mux_sel_o  = OP_B_IMM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 654:           imm_b_mux_sel_o     = IMM_B_INCR_PC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 655:           alu_operator_o      = ALU_ADD;</pre>
<pre style="margin:0; padding:0 "> 656:         end</pre>
<pre style="margin:0; padding:0 "> 657:       end</pre>
<pre style="margin:0; padding:0 "> 658: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 659:       OPCODE_JALR: begin // Jump and Link Register</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 660:         if (BranchTargetALU) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 661:           bt_a_mux_sel_o = OP_A_REG_A;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 662:           bt_b_mux_sel_o = IMM_B_I;</pre>
<pre style="margin:0; padding:0 "> 663:         end</pre>
<pre style="margin:0; padding:0 "> 664: </pre>
<pre style="margin:0; padding:0 "> 665:         // Jumps take two cycles without the BTALU</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 666:         if (instr_first_cycle_i && !BranchTargetALU) begin</pre>
<pre style="margin:0; padding:0 "> 667:           // Calculate jump target</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 668:           alu_op_a_mux_sel_o  = OP_A_REG_A;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 669:           alu_op_b_mux_sel_o  = OP_B_IMM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 670:           imm_b_mux_sel_o     = IMM_B_I;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 671:           alu_operator_o      = ALU_ADD;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 672:         end else begin</pre>
<pre style="margin:0; padding:0 "> 673:           // Calculate and store PC+4</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 674:           alu_op_a_mux_sel_o  = OP_A_CURRPC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 675:           alu_op_b_mux_sel_o  = OP_B_IMM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 676:           imm_b_mux_sel_o     = IMM_B_INCR_PC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 677:           alu_operator_o      = ALU_ADD;</pre>
<pre style="margin:0; padding:0 "> 678:         end</pre>
<pre style="margin:0; padding:0 "> 679:       end</pre>
<pre style="margin:0; padding:0 "> 680: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 681:       OPCODE_BRANCH: begin // Branch</pre>
<pre style="margin:0; padding:0 "> 682:         // Check branch condition selection</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 683:         unique case (instr_alu[14:12])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 684:           3'b000:  alu_operator_o = ALU_EQ;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 685:           3'b001:  alu_operator_o = ALU_NE;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 686:           3'b100:  alu_operator_o = ALU_LT;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 687:           3'b101:  alu_operator_o = ALU_GE;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 688:           3'b110:  alu_operator_o = ALU_LTU;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 689:           3'b111:  alu_operator_o = ALU_GEU;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 690:           default: ;</pre>
<pre style="margin:0; padding:0 "> 691:         endcase</pre>
<pre style="margin:0; padding:0 "> 692: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 693:         if (BranchTargetALU) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 694:           bt_a_mux_sel_o = OP_A_CURRPC;</pre>
<pre style="margin:0; padding:0 "> 695:           // Not-taken branch will jump to next instruction (used in secure mode)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 696:           bt_b_mux_sel_o = branch_taken_i ? IMM_B_B : IMM_B_INCR_PC;</pre>
<pre style="margin:0; padding:0 "> 697:         end</pre>
<pre style="margin:0; padding:0 "> 698: </pre>
<pre style="margin:0; padding:0 "> 699:         // Without branch target ALU, a branch is a two-stage operation using the Main ALU in both</pre>
<pre style="margin:0; padding:0 "> 700:         // stages</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 701:         if (instr_first_cycle_i) begin</pre>
<pre style="margin:0; padding:0 "> 702:           // First evaluate the branch condition</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 703:           alu_op_a_mux_sel_o  = OP_A_REG_A;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 704:           alu_op_b_mux_sel_o  = OP_B_REG_B;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 705:         end else begin</pre>
<pre style="margin:0; padding:0 "> 706:           // Then calculate jump target</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 707:           alu_op_a_mux_sel_o  = OP_A_CURRPC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 708:           alu_op_b_mux_sel_o  = OP_B_IMM;</pre>
<pre style="margin:0; padding:0 "> 709:           // Not-taken branch will jump to next instruction (used in secure mode)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 710:           imm_b_mux_sel_o     = branch_taken_i ? IMM_B_B : IMM_B_INCR_PC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 711:           alu_operator_o      = ALU_ADD;</pre>
<pre style="margin:0; padding:0 "> 712:         end</pre>
<pre style="margin:0; padding:0 "> 713:       end</pre>
<pre style="margin:0; padding:0 "> 714: </pre>
<pre style="margin:0; padding:0 "> 715:       ////////////////</pre>
<pre style="margin:0; padding:0 "> 716:       // Load/store //</pre>
<pre style="margin:0; padding:0 "> 717:       ////////////////</pre>
<pre style="margin:0; padding:0 "> 718: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 719:       OPCODE_STORE: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 720:         alu_op_a_mux_sel_o = OP_A_REG_A;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 721:         alu_op_b_mux_sel_o = OP_B_REG_B;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 722:         alu_operator_o     = ALU_ADD;</pre>
<pre style="margin:0; padding:0 "> 723: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 724:         if (!instr_alu[14]) begin</pre>
<pre style="margin:0; padding:0 "> 725:           // offset from immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 726:           imm_b_mux_sel_o     = IMM_B_S;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 727:           alu_op_b_mux_sel_o  = OP_B_IMM;</pre>
<pre style="margin:0; padding:0 "> 728:         end</pre>
<pre style="margin:0; padding:0 "> 729:       end</pre>
<pre style="margin:0; padding:0 "> 730: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 731:       OPCODE_LOAD: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 732:         alu_op_a_mux_sel_o  = OP_A_REG_A;</pre>
<pre style="margin:0; padding:0 "> 733: </pre>
<pre style="margin:0; padding:0 "> 734:         // offset from immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 735:         alu_operator_o      = ALU_ADD;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 736:         alu_op_b_mux_sel_o  = OP_B_IMM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 737:         imm_b_mux_sel_o     = IMM_B_I;</pre>
<pre style="margin:0; padding:0 "> 738:       end</pre>
<pre style="margin:0; padding:0 "> 739: </pre>
<pre style="margin:0; padding:0 "> 740:       /////////</pre>
<pre style="margin:0; padding:0 "> 741:       // ALU //</pre>
<pre style="margin:0; padding:0 "> 742:       /////////</pre>
<pre style="margin:0; padding:0 "> 743: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 744:       OPCODE_LUI: begin  // Load Upper Immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 745:         alu_op_a_mux_sel_o  = OP_A_IMM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 746:         alu_op_b_mux_sel_o  = OP_B_IMM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 747:         imm_a_mux_sel_o     = IMM_A_ZERO;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 748:         imm_b_mux_sel_o     = IMM_B_U;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 749:         alu_operator_o      = ALU_ADD;</pre>
<pre style="margin:0; padding:0 "> 750:       end</pre>
<pre style="margin:0; padding:0 "> 751: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 752:       OPCODE_AUIPC: begin  // Add Upper Immediate to PC</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 753:         alu_op_a_mux_sel_o  = OP_A_CURRPC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 754:         alu_op_b_mux_sel_o  = OP_B_IMM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 755:         imm_b_mux_sel_o     = IMM_B_U;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 756:         alu_operator_o      = ALU_ADD;</pre>
<pre style="margin:0; padding:0 "> 757:       end</pre>
<pre style="margin:0; padding:0 "> 758: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 759:       OPCODE_OP_IMM: begin // Register-Immediate ALU Operations</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 760:         alu_op_a_mux_sel_o  = OP_A_REG_A;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 761:         alu_op_b_mux_sel_o  = OP_B_IMM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 762:         imm_b_mux_sel_o     = IMM_B_I;</pre>
<pre style="margin:0; padding:0 "> 763: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 764:         unique case (instr_alu[14:12])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 765:           3'b000: alu_operator_o = ALU_ADD;  // Add Immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 766:           3'b010: alu_operator_o = ALU_SLT;  // Set to one if Lower Than Immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 767:           3'b011: alu_operator_o = ALU_SLTU; // Set to one if Lower Than Immediate Unsigned</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 768:           3'b100: alu_operator_o = ALU_XOR;  // Exclusive Or with Immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 769:           3'b110: alu_operator_o = ALU_OR;   // Or with Immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 770:           3'b111: alu_operator_o = ALU_AND;  // And with Immediate</pre>
<pre style="margin:0; padding:0 "> 771: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 772:           3'b001: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 773:             if (RV32B) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 774:               unique case (instr_alu[31:27])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 775:                 5'b0_0000: alu_operator_o = ALU_SLL;    // Shift Left Logical by Immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 776:                 5'b0_0100: alu_operator_o = ALU_SLO;    // Shift Left Ones by Immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 777:                 5'b0_1001: alu_operator_o = ALU_SBCLR;  // Clear bit specified by immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 778:                 5'b0_0101: alu_operator_o = ALU_SBSET;  // Set bit specified by immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 779:                 5'b0_1101: alu_operator_o = ALU_SBINV;  // Invert bit specified by immediate.</pre>
<pre style="margin:0; padding:0 "> 780:                 // Shuffle with Immediate Control Value</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 781:                 5'b0_0001: if (instr_alu[26] == 0) alu_operator_o = ALU_SHFL;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 782:                 5'b0_1100: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 783:                   unique case (instr_alu[26:20])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 784:                     7'b000_0000: alu_operator_o = ALU_CLZ;      // clz</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 785:                     7'b000_0001: alu_operator_o = ALU_CTZ;      // ctz</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 786:                     7'b000_0010: alu_operator_o = ALU_PCNT;     // pcnt</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 787:                     7'b000_0100: alu_operator_o = ALU_SEXTB;    // sext.b</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 788:                     7'b000_0101: alu_operator_o = ALU_SEXTH;    // sext.h</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 789:                     7'b001_0000: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 790:                       alu_operator_o = ALU_CRC32_B;  // crc32.b</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 791:                       alu_multicycle_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 792:                     end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 793:                     7'b001_0001: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 794:                       alu_operator_o = ALU_CRC32_H;  // crc32.h</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 795:                       alu_multicycle_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 796:                     end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 797:                     7'b001_0010: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 798:                       alu_operator_o = ALU_CRC32_W;  // crc32.w</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 799:                       alu_multicycle_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 800:                     end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 801:                     7'b001_1000: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 802:                       alu_operator_o = ALU_CRC32C_B; // crc32c.b</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 803:                       alu_multicycle_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 804:                     end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 805:                     7'b001_1001: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 806:                       alu_operator_o = ALU_CRC32C_H; // crc32c.h</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 807:                       alu_multicycle_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 808:                     end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 809:                     7'b001_1010: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 810:                       alu_operator_o = ALU_CRC32C_W; // crc32c.w</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 811:                       alu_multicycle_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 812:                     end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 813:                     default: ;</pre>
<pre style="margin:0; padding:0 "> 814:                   endcase</pre>
<pre style="margin:0; padding:0 "> 815:                 end</pre>
<pre style="margin:0; padding:0 "> 816: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 817:                 default: ;</pre>
<pre style="margin:0; padding:0 "> 818:               endcase</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 819:             end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 820:               alu_operator_o = ALU_SLL;                 // Shift Left Logical by Immediate</pre>
<pre style="margin:0; padding:0 "> 821:             end</pre>
<pre style="margin:0; padding:0 "> 822:           end</pre>
<pre style="margin:0; padding:0 "> 823: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 824:           3'b101: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 825:             if (RV32B) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 826:               if (instr_alu[26] == 1'b1) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 827:                 alu_operator_o = ALU_FSR;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 828:                 alu_multicycle_o = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 829:                 if (instr_first_cycle_i) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 830:                   use_rs3 = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 831:                 end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 832:                   use_rs3 = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 833:                 end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 834:               end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 835:                 unique case (instr_alu[31:27])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 836:                   5'b0_0000: alu_operator_o = ALU_SRL;   // Shift Right Logical by Immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 837:                   5'b0_1000: alu_operator_o = ALU_SRA;   // Shift Right Arithmetically by Immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 838:                   5'b0_0100: alu_operator_o = ALU_SRO;   // Shift Right Ones by Immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 839:                   5'b0_1001: alu_operator_o = ALU_SBEXT; // Extract bit specified by immediate.</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 840:                   5'b0_1100: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 841:                     alu_operator_o = ALU_ROR;           // Rotate Right by Immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 842:                     alu_multicycle_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 843:                   end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 844:                   5'b0_1101: alu_operator_o = ALU_GREV; // General Reverse with Imm Control Val</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 845:                   5'b0_0101: alu_operator_o = ALU_GORC; // General Or-combine with Imm Control Val</pre>
<pre style="margin:0; padding:0 "> 846:                   // Unshuffle with Immediate Control Value</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 847:                   5'b0_0001: if (instr_alu[26] == 1'b0) alu_operator_o = ALU_UNSHFL;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 848:                   default: ;</pre>
<pre style="margin:0; padding:0 "> 849:                 endcase</pre>
<pre style="margin:0; padding:0 "> 850:               end</pre>
<pre style="margin:0; padding:0 "> 851: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 852:             end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 853:               if (instr_alu[31:27] == 5'b0_0000) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 854:                 alu_operator_o = ALU_SRL;              // Shift Right Logical by Immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 855:               end else if (instr_alu[31:27] == 5'b0_1000) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 856:                 alu_operator_o = ALU_SRA;              // Shift Right Arithmetically by Immediate</pre>
<pre style="margin:0; padding:0 "> 857:               end</pre>
<pre style="margin:0; padding:0 "> 858:             end</pre>
<pre style="margin:0; padding:0 "> 859:           end</pre>
<pre style="margin:0; padding:0 "> 860: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 861:           default: ;</pre>
<pre style="margin:0; padding:0 "> 862:         endcase</pre>
<pre style="margin:0; padding:0 "> 863:       end</pre>
<pre style="margin:0; padding:0 "> 864: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 865:       OPCODE_OP: begin  // Register-Register ALU operation</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 866:         alu_op_a_mux_sel_o = OP_A_REG_A;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 867:         alu_op_b_mux_sel_o = OP_B_REG_B;</pre>
<pre style="margin:0; padding:0 "> 868: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 869:         if (instr_alu[26]) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 870:           if (RV32B) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 871:             unique case ({instr_alu[26:25], instr_alu[14:12]})</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 872:               {2'b11, 3'b001}: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 873:                 alu_operator_o   = ALU_CMIX; // cmix</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 874:                 alu_multicycle_o = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 875:                 if (instr_first_cycle_i) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 876:                   use_rs3 = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 877:                 end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 878:                   use_rs3 = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 879:                 end</pre>
<pre style="margin:0; padding:0 "> 880:               end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 881:               {2'b11, 3'b101}: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 882:                 alu_operator_o   = ALU_CMOV; // cmov</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 883:                 alu_multicycle_o = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 884:                 if (instr_first_cycle_i) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 885:                   use_rs3 = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 886:                 end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 887:                   use_rs3 = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 888:                 end</pre>
<pre style="margin:0; padding:0 "> 889:               end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 890:               {2'b10, 3'b001}: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 891:                 alu_operator_o   = ALU_FSL;  // fsl</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 892:                 alu_multicycle_o = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 893:                 if (instr_first_cycle_i) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 894:                   use_rs3 = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 895:                 end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 896:                   use_rs3 = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 897:                 end</pre>
<pre style="margin:0; padding:0 "> 898:               end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 899:               {2'b10, 3'b101}: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 900:                 alu_operator_o   = ALU_FSR;  // fsr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 901:                 alu_multicycle_o = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 902:                 if (instr_first_cycle_i) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 903:                   use_rs3 = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 904:                 end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 905:                   use_rs3 = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 906:                 end</pre>
<pre style="margin:0; padding:0 "> 907:               end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 908:               default: ;</pre>
<pre style="margin:0; padding:0 "> 909:             endcase</pre>
<pre style="margin:0; padding:0 "> 910:           end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 911:         end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 912:           unique case ({instr_alu[31:25], instr_alu[14:12]})</pre>
<pre style="margin:0; padding:0 "> 913:             // RV32I ALU operations</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 914:             {7'b000_0000, 3'b000}: alu_operator_o = ALU_ADD;   // Add</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 915:             {7'b010_0000, 3'b000}: alu_operator_o = ALU_SUB;   // Sub</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 916:             {7'b000_0000, 3'b010}: alu_operator_o = ALU_SLT;   // Set Lower Than</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 917:             {7'b000_0000, 3'b011}: alu_operator_o = ALU_SLTU;  // Set Lower Than Unsigned</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 918:             {7'b000_0000, 3'b100}: alu_operator_o = ALU_XOR;   // Xor</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 919:             {7'b000_0000, 3'b110}: alu_operator_o = ALU_OR;    // Or</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 920:             {7'b000_0000, 3'b111}: alu_operator_o = ALU_AND;   // And</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 921:             {7'b000_0000, 3'b001}: alu_operator_o = ALU_SLL;   // Shift Left Logical</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 922:             {7'b000_0000, 3'b101}: alu_operator_o = ALU_SRL;   // Shift Right Logical</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 923:             {7'b010_0000, 3'b101}: alu_operator_o = ALU_SRA;   // Shift Right Arithmetic</pre>
<pre style="margin:0; padding:0 "> 924: </pre>
<pre style="margin:0; padding:0 "> 925:             // RV32B ALU Operations</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 926:             {7'b001_0000, 3'b001}: if (RV32B) alu_operator_o = ALU_SLO;   // slo</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 927:             {7'b001_0000, 3'b101}: if (RV32B) alu_operator_o = ALU_SRO;   // sro</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 928:             {7'b011_0000, 3'b001}: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 929:               if (RV32B) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 930:                 alu_operator_o = ALU_ROL;   // rol</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 931:                 alu_multicycle_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 932:               end</pre>
<pre style="margin:0; padding:0 "> 933:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 934:             {7'b011_0000, 3'b101}: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 935:               if (RV32B) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 936:                 alu_operator_o = ALU_ROR;   // ror</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 937:                 alu_multicycle_o = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 938:               end</pre>
<pre style="margin:0; padding:0 "> 939:             end</pre>
<pre style="margin:0; padding:0 "> 940: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 941:             {7'b000_0101, 3'b100}: if (RV32B) alu_operator_o = ALU_MIN;    // min</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 942:             {7'b000_0101, 3'b101}: if (RV32B) alu_operator_o = ALU_MAX;    // max</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 943:             {7'b000_0101, 3'b110}: if (RV32B) alu_operator_o = ALU_MINU;   // minu</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 944:             {7'b000_0101, 3'b111}: if (RV32B) alu_operator_o = ALU_MAXU;   // maxu</pre>
<pre style="margin:0; padding:0 "> 945: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 946:             {7'b000_0100, 3'b100}: if (RV32B) alu_operator_o = ALU_PACK;   // pack</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 947:             {7'b010_0100, 3'b100}: if (RV32B) alu_operator_o = ALU_PACKU;  // packu</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 948:             {7'b000_0100, 3'b111}: if (RV32B) alu_operator_o = ALU_PACKH;  // packh</pre>
<pre style="margin:0; padding:0 "> 949: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 950:             {7'b010_0000, 3'b100}: if (RV32B) alu_operator_o = ALU_XNOR;   // xnor</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 951:             {7'b010_0000, 3'b110}: if (RV32B) alu_operator_o = ALU_ORN;    // orn</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 952:             {7'b010_0000, 3'b111}: if (RV32B) alu_operator_o = ALU_ANDN;   // andn</pre>
<pre style="margin:0; padding:0 "> 953: </pre>
<pre style="margin:0; padding:0 "> 954:             // RV32B zbp</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 955:             {7'b011_0100, 3'b101}: if (RV32B) alu_operator_o = ALU_GREV;   // grev</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 956:             {7'b001_0100, 3'b101}: if (RV32B) alu_operator_o = ALU_GORC;   // grev</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 957:             {7'b000_0100, 3'b001}: if (RV32B) alu_operator_o = ALU_SHFL;   // shfl</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 958:             {7'b000_0100, 3'b101}: if (RV32B) alu_operator_o = ALU_UNSHFL; // unshfl</pre>
<pre style="margin:0; padding:0 "> 959: </pre>
<pre style="margin:0; padding:0 "> 960:             // RV32B zbs</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 961:             {7'b010_0100, 3'b001}: if (RV32B) alu_operator_o = ALU_SBCLR;  // sbclr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 962:             {7'b001_0100, 3'b001}: if (RV32B) alu_operator_o = ALU_SBSET;  // sbset</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 963:             {7'b011_0100, 3'b001}: if (RV32B) alu_operator_o = ALU_SBINV;  // sbinv</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 964:             {7'b010_0100, 3'b101}: if (RV32B) alu_operator_o = ALU_SBEXT;  // sbext</pre>
<pre style="margin:0; padding:0 "> 965: </pre>
<pre style="margin:0; padding:0 "> 966:             // RV32B zbc</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 967:             {7'b000_0101, 3'b001}: if (RV32B) alu_operator_o = ALU_CLMUL;  // clmul</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 968:             {7'b000_0101, 3'b010}: if (RV32B) alu_operator_o = ALU_CLMULR; // clmulr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 969:             {7'b000_0101, 3'b011}: if (RV32B) alu_operator_o = ALU_CLMULH; // clmulh</pre>
<pre style="margin:0; padding:0 "> 970: </pre>
<pre style="margin:0; padding:0 "> 971:             // RV32B zbe</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 972:             {7'b010_0100, 3'b110}: if (RV32B) alu_operator_o = ALU_BDEP;   // bdep</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 973:             {7'b000_0100, 3'b110}: if (RV32B) alu_operator_o = ALU_BEXT;   // bext</pre>
<pre style="margin:0; padding:0 "> 974:             // RV32B zbf</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 975:             {7'b010_0100, 3'b111}: if (RV32B) alu_operator_o = ALU_BFP;    // bfp</pre>
<pre style="margin:0; padding:0 "> 976: </pre>
<pre style="margin:0; padding:0 "> 977:             // RV32M instructions, all use the same ALU operation</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 978:             {7'b000_0001, 3'b000}: begin // mul</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 979:               alu_operator_o = ALU_ADD;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 980:               mult_sel_o     = RV32M ? 1'b1 : 1'b0;</pre>
<pre style="margin:0; padding:0 "> 981:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 982:             {7'b000_0001, 3'b001}: begin // mulh</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 983:               alu_operator_o = ALU_ADD;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 984:               mult_sel_o     = RV32M ? 1'b1 : 1'b0;</pre>
<pre style="margin:0; padding:0 "> 985:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 986:             {7'b000_0001, 3'b010}: begin // mulhsu</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 987:               alu_operator_o = ALU_ADD;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 988:               mult_sel_o     = RV32M ? 1'b1 : 1'b0;</pre>
<pre style="margin:0; padding:0 "> 989:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 990:             {7'b000_0001, 3'b011}: begin // mulhu</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 991:               alu_operator_o = ALU_ADD;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 992:               mult_sel_o     = RV32M ? 1'b1 : 1'b0;</pre>
<pre style="margin:0; padding:0 "> 993:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 994:             {7'b000_0001, 3'b100}: begin // div</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 995:               alu_operator_o = ALU_ADD;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 996:               div_sel_o      = RV32M ? 1'b1 : 1'b0;</pre>
<pre style="margin:0; padding:0 "> 997:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 998:             {7'b000_0001, 3'b101}: begin // divu</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 999:               alu_operator_o = ALU_ADD;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1000:               div_sel_o      = RV32M ? 1'b1 : 1'b0;</pre>
<pre style="margin:0; padding:0 ">1001:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1002:             {7'b000_0001, 3'b110}: begin // rem</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1003:               alu_operator_o = ALU_ADD;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1004:               div_sel_o      = RV32M ? 1'b1 : 1'b0;</pre>
<pre style="margin:0; padding:0 ">1005:             end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1006:             {7'b000_0001, 3'b111}: begin // remu</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1007:               alu_operator_o = ALU_ADD;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1008:               div_sel_o      = RV32M ? 1'b1 : 1'b0;</pre>
<pre style="margin:0; padding:0 ">1009:             end</pre>
<pre style="margin:0; padding:0 ">1010: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1011:             default: ;</pre>
<pre style="margin:0; padding:0 ">1012:           endcase</pre>
<pre style="margin:0; padding:0 ">1013:         end</pre>
<pre style="margin:0; padding:0 ">1014:       end</pre>
<pre style="margin:0; padding:0 ">1015: </pre>
<pre style="margin:0; padding:0 ">1016:       /////////////</pre>
<pre style="margin:0; padding:0 ">1017:       // Special //</pre>
<pre style="margin:0; padding:0 ">1018:       /////////////</pre>
<pre style="margin:0; padding:0 ">1019: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1020:       OPCODE_MISC_MEM: begin</pre>
<pre style="margin:0; padding:0 ">1021:         // For now, treat the FENCE (funct3 == 000) instruction as a NOP.  This may not be correct</pre>
<pre style="margin:0; padding:0 ">1022:         // in a system with caches and should be revisited.</pre>
<pre style="margin:0; padding:0 ">1023:         // FENCE.I will flush the IF stage and prefetch buffer but nothing else.</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1024:         unique case (instr_alu[14:12])</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1025:           3'b000: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1026:             alu_operator_o     = ALU_ADD; // nop</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1027:             alu_op_a_mux_sel_o = OP_A_REG_A;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1028:             alu_op_b_mux_sel_o = OP_B_IMM;</pre>
<pre style="margin:0; padding:0 ">1029:           end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1030:           3'b001: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1031:             if (BranchTargetALU) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1032:               bt_a_mux_sel_o     = OP_A_CURRPC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1033:               bt_b_mux_sel_o     = IMM_B_INCR_PC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1034:             end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1035:               alu_op_a_mux_sel_o = OP_A_CURRPC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1036:               alu_op_b_mux_sel_o = OP_B_IMM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1037:               imm_b_mux_sel_o    = IMM_B_INCR_PC;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1038:               alu_operator_o     = ALU_ADD;</pre>
<pre style="margin:0; padding:0 ">1039:             end</pre>
<pre style="margin:0; padding:0 ">1040:           end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1041:           default: ;</pre>
<pre style="margin:0; padding:0 ">1042:         endcase</pre>
<pre style="margin:0; padding:0 ">1043:       end</pre>
<pre style="margin:0; padding:0 ">1044: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1045:       OPCODE_SYSTEM: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1046:         if (instr_alu[14:12] == 3'b000) begin</pre>
<pre style="margin:0; padding:0 ">1047:           // non CSR related SYSTEM instructions</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1048:           alu_op_a_mux_sel_o = OP_A_REG_A;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1049:           alu_op_b_mux_sel_o = OP_B_IMM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1050:         end else begin</pre>
<pre style="margin:0; padding:0 ">1051:           // instruction to read/modify CSR</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1052:           alu_op_b_mux_sel_o = OP_B_IMM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1053:           imm_a_mux_sel_o    = IMM_A_Z;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1054:           imm_b_mux_sel_o    = IMM_B_I;  // CSR address is encoded in I imm</pre>
<pre style="margin:0; padding:0 ">1055: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1056:           if (instr_alu[14]) begin</pre>
<pre style="margin:0; padding:0 ">1057:             // rs1 field is used as immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1058:             alu_op_a_mux_sel_o = OP_A_IMM;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1059:           end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1060:             alu_op_a_mux_sel_o = OP_A_REG_A;</pre>
<pre style="margin:0; padding:0 ">1061:           end</pre>
<pre style="margin:0; padding:0 ">1062:         end</pre>
<pre style="margin:0; padding:0 ">1063: </pre>
<pre style="margin:0; padding:0 ">1064:       end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1065:       default: ;</pre>
<pre style="margin:0; padding:0 ">1066:     endcase</pre>
<pre style="margin:0; padding:0 ">1067:   end</pre>
<pre style="margin:0; padding:0 ">1068: </pre>
<pre style="margin:0; padding:0 ">1069:   // do not enable multdiv in case of illegal instruction exceptions</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1070:   assign mult_en_o = illegal_insn ? 1'b0 : mult_sel_o;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1071:   assign div_en_o  = illegal_insn ? 1'b0 : div_sel_o;</pre>
<pre style="margin:0; padding:0 ">1072: </pre>
<pre style="margin:0; padding:0 ">1073:   // make sure instructions accessing non-available registers in RV32E cause illegal</pre>
<pre style="margin:0; padding:0 ">1074:   // instruction exceptions</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1075:   assign illegal_insn_o = illegal_insn | illegal_reg_rv32e;</pre>
<pre style="margin:0; padding:0 ">1076: </pre>
<pre style="margin:0; padding:0 ">1077:   // do not propgate regfile write enable if non-available registers are accessed in RV32E</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">1078:   assign rf_we_o = rf_we & ~illegal_reg_rv32e;</pre>
<pre style="margin:0; padding:0 ">1079: </pre>
<pre style="margin:0; padding:0 ">1080:   ////////////////</pre>
<pre style="margin:0; padding:0 ">1081:   // Assertions //</pre>
<pre style="margin:0; padding:0 ">1082:   ////////////////</pre>
<pre style="margin:0; padding:0 ">1083: </pre>
<pre style="margin:0; padding:0 ">1084:   // Selectors must be known/valid.</pre>
<pre style="margin:0; padding:0 ">1085:   `ASSERT(IbexRegImmAluOpKnown, (opcode == OPCODE_OP_IMM) |-></pre>
<pre style="margin:0; padding:0 ">1086:       !$isunknown(instr[14:12]))</pre>
<pre style="margin:0; padding:0 ">1087: endmodule // controller</pre>
<pre style="margin:0; padding:0 ">1088: </pre>
</body>
</html>
